<!DOCTYPE html>
<html lang="es">

<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=AW-17840964061">
</script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'AW-17840964061');
</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mi Eneatipo | Eneagrama Profesional</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <meta name="description" content="El 60‚Äì70% de las personas se confunde de eneatipo cuando responde tests conductuales.
   Este modelo mide motivaciones, no solo comportamientos, seg√∫n la escuela Riso-Hudson utilizada en psicoterapia y coaching ejecutivo." />
  <meta name="keywords" content="eneagrama, test eneatipo, personalidad, psicolog√≠a, riso hudson, test eneagrama argentina, autoconocimiento" />
  <meta name="author" content="Mi Eneatipo" />
  
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://mieneatipo.ar/" />
  <meta property="og:title" content="Test de Eneagrama Profesional | Mi Eneatipo" />
  <meta property="og:description" content="Descubr√≠ tu verdadera arquitectura interna. Hac√© el test y conoc√© tu perfil nuclear hoy mismo." />
  <meta property="og:image" content="https://mieneatipo.ar/logo.svg" />

  <link rel="icon" href="/favicon-512.png" sizes="512x512">
  <link rel="icon" href="/logo.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/favicon-512.png">

  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>


  <style>

    /* --- ESTILOS GLOBALES --- */
    :root { --bg-main:#F4EFE9; --bg-alt:#FAF8F3; --green:#2E5941; --blue:#274E55; --coral:#FF7F66; --text:#3A3A3A; --white:#FFFFFF; --shadow: 0 10px 30px rgba(39, 78, 85, 0.08); }
    * { box-sizing:border-box; margin:0; padding:0; }
    body { font-family:'Inter', sans-serif; background:var(--bg-main); color:var(--text); line-height:1.6; overflow-x:hidden; }
    
    .bg-gradient { position:fixed; inset:0; z-index:-1; background:radial-gradient(circle at 50% 50%, rgba(255,127,102,0.05), transparent 60%), var(--bg-main); }
    
    .container { max-width:900px; margin:0 auto; padding:0 20px; }
    .hidden { display:none !important; }
    .fade-in { animation:fadeIn 0.6s ease forwards; }
    @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

    /* --- TIPOGRAF√çA Y BOTONES --- */
    h1, h2, h3 { font-family:'Poppins', sans-serif; color:var(--blue); }
    h1 { font-size:clamp(2.5rem, 5vw, 3.5rem); line-height:1.1; margin-bottom:20px; font-weight:600; }
    .highlight { color:var(--coral); display:inline-block; }
    
    .btn { background:var(--coral); color:white; border:none; padding:18px 40px; border-radius:50px; font-family:'Poppins', sans-serif; font-weight:600; font-size:1rem; cursor:pointer; transition:0.3s; box-shadow:0 8px 20px rgba(255,127,102,0.25); text-transform:uppercase; letter-spacing:1px; display:inline-block; text-align:center; }
    .btn:hover { transform:translateY(-3px); background:#E06550; box-shadow:0 12px 25px rgba(255,127,102,0.35); }

    /* --- HEADER --- */
    header { padding:30px 0; } 
    .logo { display:flex; align-items:center; gap:10px; font-weight:700; color:var(--green); font-size:1.5rem; cursor:pointer; }
    .logo svg { width: 36px;   height: auto;  margin-right: 12px;   flex-shrink: 0;  stroke: currentColor; vertical-align: middle}

    /* --- HERO & FORM --- */
    .hero { padding:80px 0; min-height:70vh; display:flex; align-items:center; text-align:center; justify-content:center; }
    .form-box { background:var(--white); padding:50px; border-radius:20px; box-shadow:var(--shadow); max-width:500px; margin:40px auto; text-align:center; }
    .input-group { margin-bottom:25px; text-align:left; }
    label { font-weight:600; font-size:0.9rem; color:var(--blue); display:block; margin-bottom:8px; }
    input { width:100%; padding:15px; border:1px solid #ddd; border-radius:10px; font-size:1.1rem; background:var(--bg-alt); text-align:center; }

    /* --- QUIZ --- */
    .quiz-container { max-width:800px; margin:0 auto; text-align:center; padding:60px 0; }
    .progress-header { display:flex; justify-content:space-between; margin-bottom:8px; font-size:0.8rem; color:#888; font-weight:700; text-transform:uppercase; }
    .progress-bar { height:8px; background:#e0e0e0; border-radius:10px; margin-bottom:40px; overflow:hidden; }
    .progress-fill { height:100%; background:var(--green); width:0%; transition:width 0.3s ease; }
    
    .question-card { background:var(--white); padding:50px 30px; border-radius:20px; box-shadow:0 15px 40px rgba(0,0,0,0.04); min-height:300px; display:flex; flex-direction:column; justify-content:center; }
    .q-text { font-size:1.6rem; font-weight:500; color:var(--blue); margin-bottom:40px; font-family:'Poppins', sans-serif; }
    
  /* --- ESCALA DE PREGUNTAS (CON RETRASO VISUAL) --- */
    .scale-container { display:flex; justify-content:space-between; align-items:flex-start; gap:10px; margin-top:20px; width:100%; }
    
    .scale-option { 
      flex:1; display:flex; flex-direction:column; align-items:center; cursor:pointer; 
      -webkit-tap-highlight-color: transparent; 
    }
    .scale-option:active { transform: scale(0.90); } 

    .scale-circle { 
      width:55px; height:55px; border-radius:50%; border:2px solid #ddd; background:#fff; 
      display:flex; align-items:center; justify-content:center; font-weight:700; font-size:1.3rem; color:#aaa; margin-bottom:12px; 
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; 
    }
    
    .scale-label { font-size:0.7rem; font-weight:700; text-transform:uppercase; color:#999; text-align:center; line-height:1.2; transition: color 0.3s ease; }
    
    /* --- COLORES ACTIVOS (Funciona al Tocar :active Y al Seleccionar .selected) --- */
    
    /* Opci√≥n 1 */
    .scale-option:nth-child(1):active .scale-circle, 
    .scale-option:nth-child(1).selected .scale-circle { background:#D66D5E; border-color:#D66D5E; color:white; transition: none; }
    .scale-option:nth-child(1):active .scale-label,
    .scale-option:nth-child(1).selected .scale-label { color:#D66D5E; transition: none; }

    /* Opci√≥n 2 */
    .scale-option:nth-child(2):active .scale-circle,
    .scale-option:nth-child(2).selected .scale-circle { background:#E89F71; border-color:#E89F71; color:white; transition: none; }
    .scale-option:nth-child(2):active .scale-label,
    .scale-option:nth-child(2).selected .scale-label { color:#E89F71; transition: none; }

    /* Opci√≥n 3 */
    .scale-option:nth-child(3):active .scale-circle,
    .scale-option:nth-child(3).selected .scale-circle { background:#D9C375; border-color:#D9C375; color:white; transition: none; }
    .scale-option:nth-child(3):active .scale-label,
    .scale-option:nth-child(3).selected .scale-label { color:#D9C375; transition: none; }

    /* Opci√≥n 4 */
    .scale-option:nth-child(4):active .scale-circle,
    .scale-option:nth-child(4).selected .scale-circle { background:#87B38D; border-color:#87B38D; color:white; transition: none; }
    .scale-option:nth-child(4):active .scale-label,
    .scale-option:nth-child(4).selected .scale-label { color:#87B38D; transition: none; }

    /* Opci√≥n 5 */
    .scale-option:nth-child(5):active .scale-circle,
    .scale-option:nth-child(5).selected .scale-circle { background:var(--green); border-color:var(--green); color:white; transition: none; }
    .scale-option:nth-child(5):active .scale-label,
    .scale-option:nth-child(5).selected .scale-label { color:var(--green); transition: none; }

    /* PC Hover (Solo Mouse) */
    @media (hover: hover) {
        .scale-option:nth-child(1):hover .scale-circle { background:#D66D5E; border-color:#D66D5E; color:white; }
        .scale-option:nth-child(1):hover .scale-label { color:#D66D5E; }
        .scale-option:nth-child(2):hover .scale-circle { background:#E89F71; border-color:#E89F71; color:white; }
        .scale-option:nth-child(2):hover .scale-label { color:#E89F71; }
        .scale-option:nth-child(3):hover .scale-circle { background:#D9C375; border-color:#D9C375; color:white; }
        .scale-option:nth-child(3):hover .scale-label { color:#D9C375; }
        .scale-option:nth-child(4):hover .scale-circle { background:#87B38D; border-color:#87B38D; color:white; }
        .scale-option:nth-child(4):hover .scale-label { color:#87B38D; }
        .scale-option:nth-child(5):hover .scale-circle { background:var(--green); border-color:var(--green); color:white; }
        .scale-option:nth-child(5):hover .scale-label { color:var(--green); }
    }
    /* --- RESULTADOS --- */
    .result-header { text-align:center; margin-bottom:40px; }
    .result-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:20px; margin-bottom:40px; }
    .result-card { background:var(--white); padding:10px; border-radius:15px; text-align:center; border:1px solid rgba(0,0,0,0.05); box-shadow:0 5px 20px rgba(0,0,0,0.03); display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 140px; }
    .card-label { font-size:0.8rem; color:#888; font-weight:700; text-transform:uppercase; display:block; margin-bottom:10px; letter-spacing:1px; }
    .card-val { font-size:clamp(1.1rem, 3vw, 1.8rem); font-weight:700; color:var(--blue); line-height: 1.2; word-break: break-word; }
    
    .report-box { position:relative; background:var(--white); padding:60px; border-radius:20px; box-shadow:var(--shadow); text-align:left; }
    .ai-text { color:#444; line-height:1.9; font-size:1.1rem; }
    .ai-text h3 { color:var(--green); margin-top:40px; margin-bottom:20px; border-bottom:2px solid var(--bg-main); padding-bottom:10px; font-size:1.4rem; }
    .ai-text h3:first-child { margin-top:0; }
    .ai-text strong { color:var(--blue); font-weight:700; }
    .ai-text ul { margin-left:20px; margin-bottom:30px; }
    .ai-text li { margin-bottom:10px; padding-left:5px; }

    .loader { border:4px solid #f3f3f3; border-top:4px solid var(--coral); border-radius:50%; width:60px; height:60px; animation:spin 1s linear infinite; margin:0 auto 20px; }
    @keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }
    #btn-back:hover { color: var(--coral) !important; text-decoration: underline; }

    /* PANTALLA DE PAGO */
    .pay-gate { background: var(--white); padding: 50px 20px; border-radius: 20px; box-shadow: var(--shadow); text-align: center; max-width: 600px; margin: 40px auto; }
    .social-proof { background: #e8f5e9; color: var(--green); display: inline-block; padding: 5px 15px; border-radius: 50px; font-size: 0.85rem; font-weight: 700; margin-bottom: 20px; }
    .checkout-box { border: 2px solid var(--green); background: #fff; padding: 25px; border-radius: 15px; margin-bottom: 30px; }
    .price-tag { display: flex; justify-content: space-between; align-items: center; font-weight: 700; font-size: 1.2rem; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
    .feature-list { text-align: left; margin: 0 auto 30px auto; max-width: 500px; }
    .feature-item { display: flex; gap: 12px; margin-bottom: 12px; align-items: flex-start; color: #555; font-size: 0.95rem; }
    .icon-check { color: var(--white); background: var(--green); border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; flex-shrink: 0; margin-top: 2px; }

    /* ESTILOS LANDING (HOME) */
    .badge-verified { background: #e6f4ea; color: var(--green); padding: 8px 16px; border-radius: 50px; font-size: 0.85rem; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; margin-bottom: 25px; border: 1px solid rgba(46, 89, 65, 0.1); }
    .benefits-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 50px; text-align: left; }
    .benefit-card { background: white; padding: 30px 25px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.04); transition: transform 0.3s ease; border: 1px solid rgba(0,0,0,0.02); }
    .benefit-card:hover { transform: translateY(-5px); }
    .benefit-icon { width: 50px; height: 50px; background: #e6f4ea; color: var(--green); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-bottom: 15px; }
    .benefit-title { font-weight: 700; color: var(--blue); margin-bottom: 8px; font-size: 1.1rem; }
    .benefit-desc { font-size: 0.9rem; color: #666; line-height: 1.5; }
    .preview-section { margin-top: 60px; text-align: left; background: white; padding: 30px; border-radius: 20px; box-shadow: var(--shadow); }
    .preview-list li { margin-bottom: 12px; display: flex; gap: 10px; align-items: center; color: #444; }

/* --- SLIDER DE TESTIMONIOS (DEFINITIVO) --- */
    .slider-container { 
      max-width: 800px; 
      margin: 40px auto; 
      padding: 0 10px;
      position: relative;
    }

    .slider-title { 
      text-align: center; 
      color: var(--blue); 
      font-size: 1.4rem; 
      font-weight: 700; 
      margin-bottom: 20px; 
      display: flex; align-items: center; justify-content: center; gap: 10px; 
    }

    /* ESTA ES LA CLASE QUE FALTABA PARA ENCUADRAR */
    .slider-wrapper {
      position: relative;
      padding: 0 45px; /* Espacio para las flechas */
    }

    .slider-window { 
      overflow: hidden; 
      border-radius: 20px; 
      background: #fff; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
      border: 1px solid rgba(0,0,0,0.05); 
      position: relative;
    }

    .slider-track { 
      display: flex; 
      transition: transform 0.5s ease-in-out; 
      width: 100%; 
      margin: 0; padding: 0;
    }
    
    .slide { 
      flex: 0 0 100%; 
      width: 100%;
      box-sizing: border-box; 
      padding: 40px; 
      display: flex; 
      align-items: center; 
      gap: 30px; 
      justify-content: center;
    }

    .slide-img-box { 
      flex-shrink: 0; 
      width: 110px; height: 110px; 
      border-radius: 50%; 
      overflow: hidden; 
      border: 4px solid #e6f4ea; 
    }
    .slide-img-box img { width: 100%; height: 100%; object-fit: cover; }
    .slide-content { text-align: left; flex: 1; }
    .stars { color: #FFC107; letter-spacing: 2px; margin-bottom: 10px; font-size: 1rem; }
    .quote-text { font-size: 0.95rem; color: #555; font-style: italic; line-height: 1.5; margin-bottom: 15px; display: block; }
    .author-name { font-weight: 800; color: var(--text); font-size: 1rem; display: block; }
    .author-type { color: var(--green); font-weight: 600; font-size: 0.85rem; text-transform: uppercase; margin-top: 4px; display: block;}

    /* FLECHAS */
    .slider-btn { 
      position: absolute; 
      top: 50%; 
      transform: translateY(-50%); 
      width: 40px; height: 40px; 
      background: white; 
      border: 1px solid #eee; 
      border-radius: 50%; 
      cursor: pointer; 
      display: flex; align-items: center; justify-content: center; 
      font-weight: bold; color: var(--blue); 
      box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
      z-index: 100; 
      font-size: 1.2rem; 
    }
    .slider-btn:hover { background: var(--green); color: white; border-color: var(--green); }
    .prev-btn { left: 0; }
    .next-btn { right: 0; }

    @media (max-width: 600px) {
      .slider-wrapper { padding: 0; }
      .slide { flex-direction: column; text-align: center; padding: 40px 20px 60px 20px; }
      .slide-content { text-align: center; }
      .slide-img-box { width: 90px; height: 90px; margin-bottom: 15px; }
      /* Flechas abajo en celular */
      .slider-btn { top: auto; bottom: 10px; width: 35px; height: 35px; }
      .prev-btn { left: 30%; transform: translateX(-50%); }
      .next-btn { right: 30%; transform: translateX(50%); }
    }
/* CORRECCI√ìN PARA QUE SE VEA EL SLIDER EN HOME */
    .hero-landing {
        display: block !important; /* Fuerza bloque vertical */
        padding-top: 40px;
        padding-bottom: 80px;
        height: auto !important; /* Deja que crezca lo que necesite */
        min-height: 100vh;
        text-align: center;
    }
    
    /* Asegura que los slides no se achiquen */
    .slide { flex-shrink: 0; }
/* --- CORRECCI√ìN PARA CELULARES --- */
@media (max-width: 600px) {
  .question-card { padding: 30px 15px !important; }
  .q-text { font-size: 1.3rem !important; }
  .scale-circle { width: 40px !important; height: 40px !important; font-size: 1rem !important; border-width: 1px !important; }
  .scale-container { gap: 4px !important; }
  .scale-label { font-size: 0.6rem !important; margin-top: 4px !important; }
    
  }
  </style>
</head>
<body>

<div class="bg-gradient"></div>

<div class="container">
<header>
  <div class="logo" onclick="location.reload()">
    <img src="logo.svg" alt="S√≠mbolo Eneagrama" style="width: 40px; height: auto; margin-right: 8px;">
    Mi Eneatipo
  </div>
</header>

<div style="text-align: center; margin-bottom: 20px;">
   <div class="badge-verified" style="margin-bottom: 0;">
     <span>‚úì</span> Basado en metodolog√≠a Riso-Hudson & Psicolog√≠a Transpersonal
   </div>
</div>

 <div style="text-align:center; margin: 10px 0 25px 0;">
  <div class="social-proof" style="background:#fff3ef; color:#E06550;">
    üî• +8.250 de personas en Argentina ya hicieron el test </div>
</div>


<div id="view-home" class="fade-in">
    <section class="hero hero-landing">

      <h1 style="margin-bottom: 15px;">Descubr√≠ tu verdadera<br><span class="highlight">Arquitectura interna.</span></h1>
      
      <p style="font-size:1.2rem; max-width:700px; margin:0 auto 30px auto; opacity:0.8; line-height: 1.6;">
        El test de Eneagrama m√°s preciso para identificar tu Eneatipo, entender tus motivaciones inconscientes y potenciar tu crecimiento personal.
      </p>
      
      <button class="btn" onclick="beginTest()" style="padding: 20px 50px; font-size: 1.1rem; margin-bottom: 20px;">
        EMPEZAR TEST
      </button>
      
      <div style="font-size: 0.8rem; color: #888; margin-bottom: 60px;">
        ‚è± Toma s√≥lo 5 minutos ‚Ä¢ üîí Tus datos est√°n seguros y sin crear cuenta
      </div>

      <div class="benefits-grid" style="margin-bottom: 60px;">
        <div class="benefit-card">
          <div class="benefit-icon">üß†</div>
          <div class="benefit-title">Tu Perfil Nuclear</div>
          <div class="benefit-desc">Identific√° la estructura que organiza tus decisiones, miedos y prioridades - incluso cuando no sos consciente de ello.</div>
        </div>
        <div class="benefit-card">
          <div class="benefit-icon">üõ°Ô∏è</div>
          <div class="benefit-title">Mecanismos de Defensa</div>
          <div class="benefit-desc">Detect√° los automatismos que se activan bajo estr√©s y aprend√© c√≥mo interrumpirlos antes de que tomen el control.</div>
        </div>
        <div class="benefit-card">
          <div class="benefit-icon">üöÄ</div>
          <div class="benefit-title">Ruta de Crecimiento Personalizada</div>
          <div class="benefit-desc">Estrategias concretas para desarrollar lo que tu eneatipo necesita integrar y dejar de reforzar lo que te limita.</div>
        </div>
      </div>

      <div style="background:white; padding:40px 30px; border-radius:20px; text-align:left; border: 1px solid rgba(0,0,0,0.05); max-width: 600px; margin: 0 auto 60px auto; box-shadow: 0 10px 40px rgba(0,0,0,0.05);">
        <h3 style="font-size:1.4rem; margin-bottom:25px; color:var(--blue); font-weight: 700; text-align: center;">Qu√© vas a entender sobre vos (y qu√© vas a poder cambiar)</h3>

        <div class="feature-list" style="margin:0 auto;">
           <div class="feature-item">
              <div class="icon-check">‚úì</div>
              <div><strong>Tu Eneatipo dominante, Ala e Instinto:</strong> C√≥mo se combina tu estructura central y por qu√© reaccion√°s como reaccion√°s.</div>
           </div>
           <div class="feature-item">
              <div class="icon-check">‚úì</div>
              <div>An√°lisis de tu <strong>Herida de Origen y Deseo B√°sico:</strong> El motor inconsciente que dirige tus decisiones, v√≠nculos y formas de protegerte.</div>
           </div>
           <div class="feature-item">
              <div class="icon-check">‚úì</div>
              <div><strong>Estrategias y pr√°cticas personalizadas:</strong> Acciones concretas adaptadas a tu eneatipo para salir del piloto autom√°tico.</div>
           </div>
           <div class="feature-item">
              <div class="icon-check">‚úì</div>
              <div><strong>Informe digital completo:</strong> Un mapa claro de tu estructura interna y tu ruta de crecimiento personal.</div>
           </div>
        </div>
      </div>

<div style="background:white; padding:40px 30px; border-radius:20px; margin: 0 auto 40px auto; max-width: 800px; box-shadow: 0 10px 40px rgba(0,0,0,0.05);">
  <h3 style="text-align:center; font-size:1.4rem; margin-bottom: 25px;">¬øC√≥mo funciona?</h3>

  <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px;">
    <div style="text-align:center; padding: 10px;">
      <div style="width:42px;height:42px;border-radius:50%;background:#fff3ef;color:#E06550;font-weight:800;display:inline-flex;align-items:center;justify-content:center;">1</div>
      <div style="font-weight:800; margin-top:10px; color:var(--blue);">Respond√© 60 preguntas</div>
      <div style="font-size:0.95rem; color:#666; margin-top:6px;">Toma 5 minutos desde el celular.</div>
    </div>

    <div style="text-align:center; padding: 10px;">
      <div style="width:42px;height:42px;border-radius:50%;background:#e6f4ea;color:var(--green);font-weight:800;display:inline-flex;align-items:center;justify-content:center;">2</div>
      <div style="font-weight:800; margin-top:10px; color:var(--blue);">La IA analiza</div>
      <div style="font-size:0.95rem; color:#666; margin-top:6px;">Basada en el m√©todo Riso-Hudson, mide motivaciones (no solo conductas).</div>
    </div>

    <div style="text-align:center; padding: 10px;">
      <div style="width:42px;height:42px;border-radius:50%;background:#eef2ff;color:var(--blue);font-weight:800;display:inline-flex;align-items:center;justify-content:center;">3</div>
      <div style="font-weight:800; margin-top:10px; color:var(--blue);">Recib√≠s tu reporte</div>
      <div style="font-size:0.95rem; color:#666; margin-top:6px;">Eneatipo, ala, subtipo y gu√≠a pr√°ctica de integraci√≥n.</div>
    </div>
  </div>
</div>

      
      <div class="slider-container">
        <h3 class="slider-title">üí¨ La opini√≥n de nuestros usuarios</h3>
        
        <div class="slider-wrapper">
            <button class="slider-btn prev-btn" onclick="moveSlide(-1)">&#10094;</button>
            
        <div class="slider-window">
  <div class="slider-track">

    <div class="slide">
      <div class="slide-img-box">
        <img src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?auto=format&fit=crop&w=200&h=200">
      </div>
      <div class="slide-content">
        <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        <span class="quote-text">"Hice otros tests antes pero eran muy gen√©ricos. Este fue distinto: me hizo reflexionar de verdad. Descubr√≠ que buscaba validaci√≥n constante."</span>
        <span class="author-name">Martina S√°nchez</span>
        <span class="author-type">34 a√±os, C√≥rdoba</span>
      </div>
    </div>

    <div class="slide">
      <div class="slide-img-box">
        <img src="https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&w=200&h=200">
      </div>
      <div class="slide-content">
        <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        <span class="quote-text">"Me costaba horrores comprometerme. Entender mi 'miedo a perderme algo' fue clave para enfocarme. De verdad funciona, me vino muy bien"</span>
        <span class="author-name">Juli√°n Mendez</span>
        <span class="author-type">31 a√±os, Buenos Aires</span>
      </div>
    </div>

    <div class="slide">
      <div class="slide-img-box">
        <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=200&h=200">
      </div>
      <div class="slide-content">
        <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        <span class="quote-text">"Me describi√≥ tal cual: me guardo todo para no discutir y termino explotando. La gu√≠a de crecimiento me ayuda un mont√≥n."</span>
        <span class="author-name">Clara Fern√°ndez</span>
        <span class="author-type">29 a√±os, Buenos Aires</span>
      </div>
    </div>

    <div class="slide">
      <div class="slide-img-box">
        <img src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?auto=format&fit=crop&w=200&h=200">
      </div>
      <div class="slide-content">
        <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        <span class="quote-text">"Soy esc√©ptico, pero la precisi√≥n del an√°lisis de riesgo me sorprendi√≥. Una herramienta muy √∫til."</span>
        <span class="author-name">Federico L√≥pez</span>
        <span class="author-type">40 a√±os, Mendoza</span>
      </div>
    </div>

    <div class="slide">
      <div class="slide-img-box">
        <img src="https://images.unsplash.com/photo-1560250097-0b93528c311a?auto=format&fit=crop&w=200&h=200">
      </div>
      <div class="slide-content">
        <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        <span class="quote-text">"Era insoportable con los detalles. Entender a mi 'cr√≠tico interno' me dio paz mental."</span>
        <span class="author-name">Gonzalo Duarte</span>
        <span class="author-type">54 a√±os, Rosario</span>
      </div>
    </div>

    <div class="slide">
      <div class="slide-img-box">
        <img src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?auto=format&fit=crop&w=200&h=200">
      </div>
      <div class="slide-content">
        <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        <span class="quote-text">"Me la pasaba desviviendome por los dem√°s. El reporte me cant√≥ la justa: tengo que aprender a decir que no."</span>
        <span class="author-name">Valentina Ricci</span>
        <span class="author-type">28 a√±os, Buenos Aires</span>
      </div>
    </div>

    <div class="slide">
      <div class="slide-img-box">
        <img src="https://images.unsplash.com/photo-1583195764036-6dc248ac07d9?auto=format&fit=crop&w=200&h=200">
      </div>
      <div class="slide-content">
        <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        <span class="quote-text">"Descubr√≠ que mi eneatipo busca control para no ser herido. Me ayud√≥ a bajar un cambio."</span>
        <span class="author-name">Esteban K.</span>
        <span class="author-type">32 a√±os, Rosario</span>
      </div>
    </div>

  </div>
</div>

            
            <button class="slider-btn next-btn" onclick="moveSlide(1)">&#10095;</button>
        </div>
    </div>
    
    <button class="btn" onclick="beginTest()" style="padding: 20px 50px; font-size: 1.1rem; margin-top: 20px;">
        EMPEZAR TEST
    </button>

    </section>
</div>

<div id="view-quiz" class="hidden fade-in">
   <div class="quiz-container">
     <div class="progress-header">
       <span>Tu progreso</span>
       <span id="progress-text">0%</span>
     </div>
     <div class="progress-bar">
       <div class="progress-fill" id="progress-fill"></div>
     </div>

     <div class="question-card">
       <div id="q-text" class="q-text">Cargando pregunta...</div>

       <div class="scale-container">
         <div class="scale-option" onclick="vote(1)">
           <div class="scale-circle">1</div>
           <div class="scale-label">Nunca</div>
         </div>
         <div class="scale-option" onclick="vote(2)">
           <div class="scale-circle">2</div>
           <div class="scale-label">Casi nunca</div>
         </div>
         <div class="scale-option" onclick="vote(3)">
           <div class="scale-circle">3</div>
           <div class="scale-label">A veces</div>
         </div>
         <div class="scale-option" onclick="vote(4)">
           <div class="scale-circle">4</div>
           <div class="scale-label">Frecuente</div>
         </div>
         <div class="scale-option" onclick="vote(5)">
           <div class="scale-circle">5</div>
           <div class="scale-label">Siempre</div>
         </div>
       </div>
     </div>

     <div style="margin-top:30px; display:flex; justify-content:center;">
        <button id="btn-back" onclick="goBack()" style="background:none; border:none; color:#888; font-weight:600; cursor:pointer; font-size:0.9rem;">
          &larr; Volver a la anterior
        </button>
     </div>
   </div>
</div>
  <div id="view-loading" class="hidden fade-in" style="text-align:center; padding:100px 0;">
    <div class="loader"></div>
    <h3 style="color:var(--blue)">Armando tu reporte...</h3>
    <p>Esto puede tardar unos segundos.</p>
  </div>

  <div id="view-result" class="hidden fade-in">
    
    <div id="payment-gate" class="pay-gate">
      <div class="social-proof">üî• +8.250 de personas en Argentina ya hicieron el test</div>
      <h2 style="margin-bottom:10px; line-height:1.2;">Tu resultado esta listo</h2>
      <p style="margin-bottom:30px; color:#666;">Desbloque√° tu reporte completo y empez√° tu camino de crecimiento.</p>

      <div class="checkout-box">
        <div class="price-tag">
          <span>Reporte Premium + Gu√≠a</span>
          <span style="color:var(--green);">$4.800</span>
        </div>

      <div class="input-group" style="max-width:420px; margin: 0 auto 15px auto;">
  <label for="checkout-name" style="text-align:left;">¬øC√≥mo te gustar√≠a que aparezca tu nombre en el reporte?</label>
  <input type="text" id="checkout-name" placeholder="Tu nombre" />
</div>
<div id="checkout-err" style="display:none; color:red; font-weight:600; margin-bottom:10px;"></div>

       <button id="mp-pay-btn" class="btn" style="width:100%; font-size:1.1rem; padding: 20px;">
          OBTENER MIS RESULTADOS
       </button>
        <div style="font-size:0.75rem; color:#999; margin-top:10px; display:flex; justify-content:center; gap:15px;">
          <span>üîí Pago 100% Seguro</span>
          <span>‚ö° Acceso Inmediato</span>
        </div>
      </div>

      <div class="feature-list">
        <div class="feature-item"><div class="icon-check">‚úì</div><div><strong>Perfil Nuclear:</strong> Identificaci√≥n precisa de tu Eneatipo, Ala e Instinto.</div></div>
        <div class="feature-item"><div class="icon-check">‚úì</div><div><strong>An√°lisis Inconsciente:</strong> Descubr√≠ tu Herida de origen y tu Deseo fundamental.</div></div>
        <div class="feature-item"><div class="icon-check">‚úì</div><div><strong>Tu Defensa:</strong> Entend√© cu√°l es tu mecanismo de defensa y c√≥mo te limita.</div></div>
        <div class="feature-item"><div class="icon-check">‚úì</div><div><strong>Ruta de Crecimiento:</strong> Camino de integraci√≥n y pr√°cticas de alineaci√≥n personal.</div></div>
      </div>
      
<div class="slider-container">
        <h3 class="slider-title">üí¨ La opini√≥n de nuestros usuarios</h3>
        
        <div class="slider-wrapper">
            <button class="slider-btn prev-btn" onclick="moveSlide(-1)">&#10094;</button>
            
            <div class="slider-window">
              <div class="slider-track">
                <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Hice otros tests antes pero eran muy gen√©ricos. Este fue distinto: me hizo reflexionar de verdad. Descubr√≠ que buscaba validaci√≥n constante."</span><span class="author-name">Martina S√°nchez</span><span class="author-type">Eneatipo 3 (El Triunfador)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Me costaba horrores comprometerme. Entender mi 'miedo a perderme algo' fue clave para enfocarme. De verdad funciona, me vino muy bien"</span><span class="author-name">Juli√°n Mendez</span><span class="author-type">Eneatipo 7 (El Entusiasta)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Me describi√≥ tal cual: me guardo todo para no discutir y termino explotando. La gu√≠a de crecimiento me ayuda un mont√≥n."</span><span class="author-name">Clara Fern√°ndez</span><span class="author-type">Eneatipo 9 (El Pacificador)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Soy esc√©ptico, pero la precisi√≥n del an√°lisis de riesgo me sorprendi√≥. Una herramienta muy √∫til."</span><span class="author-name">Federico L√≥pez</span><span class="author-type">Eneatipo 6 (El Leal)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1560250097-0b93528c311a?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Era insoportable con los detalles. Entender a mi 'cr√≠tico interno' me dio paz mental."</span><span class="author-name">Gonzalo Duarte</span><span class="author-type">Eneatipo 1 (El Reformador)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Me la pasaba desviviendome por los dem√°s. El reporte me cant√≥ la justa: tengo que aprender a decir que no."</span><span class="author-name">Valentina Ricci</span><span class="author-type">Eneatipo 2 (El Ayudador)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1583195764036-6dc248ac07d9?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Descubr√≠ que mi eneatipo busca control para no ser herido. Me ayud√≥ a bajar un cambio."</span><span class="author-name">Esteban K.</span><span class="author-type">Eneatipo 8 (El Desafiador)</span></div></div>
              </div>
            </div>
            
            <button class="slider-btn next-btn" onclick="moveSlide(1)">&#10095;</button>
        </div>
    </div>

   </div>

    <div id="actual-report" class="hidden">
      <div class="result-header">
        <span class="badge" style="background:#E6F4EA; color:#1E8E3E; padding:5px 15px; border-radius:15px; font-weight:700;">‚úì REPORTE DESBLOQUEADO</span>
        <h2 style="margin-top:15px;">Tu Mapa Interno</h2>
        <p>Hola <strong id="r-name"></strong>, este es tu dise√±o √∫nico.</p>
      </div>
      <div class="result-grid">
        <div class="result-card" style="background:var(--blue);">
          <span class="card-label" style="color:rgba(255,255,255,0.7)">ENEATIPO</span>
          <div class="card-val" style="color:white;" id="r-type">...</div>
        </div>
        <div class="result-card">
          <span class="card-label">ALA DOMINANTE</span>
          <div class="card-val" id="r-wing">...</div>
        </div>
        <div class="result-card">
          <span class="card-label">INSTINTO</span>
          <div class="card-val" id="r-instinct">...</div>
        </div>
      </div>
      <div class="report-box">
  <!-- ACCIONES -->
      <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:18px;">
        <input
          id="email-input"
          type="email"
          placeholder="Tu email para recibir el informe"
          style="flex:1; min-width:220px; padding:12px; border:1px solid #ddd; border-radius:10px; font-size:1rem; background:#FAF8F3;"
        />
        <button class="btn" id="btn-send-email" onclick="sendReportByEmail()" style="padding:14px 18px;">
      ENVIAR POR MAIL
        </button>
        <button class="btn" onclick="downloadPDF()" style="padding:14px 18px;">
      DESCARGAR PDF
        </button>
      </div>

      <!-- MENSAJES -->
      <div id="actions-msg" style="display:none; margin-bottom:18px; font-weight:600;"></div>

      <!-- CONTENIDO -->
      <div id="ai-content" class="ai-text"></div>
    </div>

    </div>
    <div id="error-msg" style="color:red; text-align:center; display:none; margin-top:20px;"></div>
  </div>
</div>

<script>
  // --- 1. FUNCIONES UI ---
  function nav(id) {
    document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
    window.scrollTo(0,0);
  }
  
function safeShowError(text) {
  try {
    nav("view-result");
  } catch {}

  const msg = document.getElementById("error-msg");
  if (msg) {
    msg.style.display = "block";
    msg.innerText = text;
  } else {
    alert(text);
  }
}


function track(evt, params = {}) {
  try { if (typeof gtag === "function") gtag("event", evt, params); } catch {}
}

function beginTest() {
  track("begin_test");
  qIdx = 0;
  historyStack = [];

  userResponses = {
  types: { 1:{}, 2:{}, 3:{}, 4:{}, 5:{}, 6:{}, 7:{}, 8:{}, 9:{} },
  instincts: { sp:{}, sx:{}, so:{} }
};


  nav("view-quiz");
  track("quiz_start");
  renderQ();
}



  // --- 2. VARIABLES ---
  let user = { name: "" };
  let userResponses = {
  types: { 1:{}, 2:{}, 3:{}, 4:{}, 5:{}, 6:{}, 7:{}, 8:{}, 9:{} },
  instincts: { sp:{}, sx:{}, so:{} }
};

  let qIdx = 0;
  let historyStack = [];

  // --- 3. PREGUNTAS ---
const questions = [
  // =========================
  // 45 PREGUNTAS ENEATIPO (5 x tipo)
  // =========================

  // Tipo 1
  { kind: "type", t: 1, q: "Busco hacer las cosas correctamente porque siento una presi√≥n interna por cumplir con lo que considero correcto." },
  { kind: "type", t: 1, q: "Me cuesta relajarme porque siempre percibo que algo podr√≠a hacerse mejor." },
  { kind: "type", t: 1, q: "Me critico con dureza porque siento que no deber√≠a cometer errores." },
  { kind: "type", t: 1, q: "Siento incomodidad o culpa porque no logro cumplir con mis propios ideales." },
  { kind: "type", t: 1, q: "Contengo mi enojo porque creo que expresarlo ser√≠a inapropiado o injusto." },

  // Tipo 2
  { kind: "type", t: 2, q: "Estoy atento a las necesidades de los dem√°s porque temo no ser querido si no soy necesario." },
  { kind: "type", t: 2, q: "Me cuesta reconocer mis propias necesidades porque priorizo el bienestar de los dem√°s." },
  { kind: "type", t: 2, q: "Ofrezco ayuda incluso sin que me la pidan porque temo ser dejado de lado." },
  { kind: "type", t: 2, q: "Me esfuerzo por agradar porque temo perder el afecto de las personas importantes." },
  { kind: "type", t: 2, q: "Busco cercan√≠a afectiva porque necesito sentir que soy valioso para otros." },

  // Tipo 3
  { kind: "type", t: 3, q: "Me esfuerzo por lograr objetivos porque necesito sentir que valgo por lo que hago." },
  { kind: "type", t: 3, q: "Busco ser eficiente porque temo fracasar y perder reconocimiento." },
  { kind: "type", t: 3, q: "Evito mostrar debilidades porque temo parecer incompetente." },
  { kind: "type", t: 3, q: "Me enfoco en resultados porque siento que el valor personal depende del rendimiento." },
  { kind: "type", t: 3, q: "Me esfuerzo por mantener una imagen exitosa porque as√≠ siento que tengo identidad." },

  // Tipo 4
  { kind: "type", t: 4, q: "Me siento diferente a los dem√°s porque percibo que me falta algo esencial." },
  { kind: "type", t: 4, q: "Busco profundidad emocional porque temo vivir una vida vac√≠a o superficial." },
  { kind: "type", t: 4, q: "Me comparo con otros porque siento que ellos tienen algo que yo no tengo." },
  { kind: "type", t: 4, q: "Busco una identidad propia porque temo no tener un lugar claro." },
  { kind: "type", t: 4, q: "Idealizo lo que no tengo porque me conecta con el anhelo." },

  // Tipo 5
  { kind: "type", t: 5, q: "Me distancio emocionalmente porque temo quedarme sin recursos internos." },
  { kind: "type", t: 5, q: "Busco comprender antes de actuar porque necesito sentirme preparado." },
  { kind: "type", t: 5, q: "Protejo mi tiempo y energ√≠a porque temo sentirme invadido." },
  { kind: "type", t: 5, q: "Me retiro del contacto social porque necesito conservar mi autonom√≠a." },
  { kind: "type", t: 5, q: "Acumulo conocimiento porque siento que as√≠ puedo manejar el mundo." },

  // Tipo 6
  { kind: "type", t: 6, q: "Busco seguridad porque temo que algo salga mal." },
  { kind: "type", t: 6, q: "Me mantengo alerta porque necesito anticipar riesgos." },
  { kind: "type", t: 6, q: "Dudo de mis decisiones porque temo equivocarme." },
  { kind: "type", t: 6, q: "Busco apoyo externo porque necesito sentir respaldo." },
  { kind: "type", t: 6, q: "Desconf√≠o inicialmente porque temo ser traicionado." },

  // Tipo 7
  { kind: "type", t: 7, q: "Busco nuevas experiencias porque temo sentirme limitado o atrapado." },
  { kind: "type", t: 7, q: "Evito el dolor porque quiero mantenerme bien." },
  { kind: "type", t: 7, q: "Cambio de intereses porque temo aburrirme o perder opciones." },
  { kind: "type", t: 7, q: "Me distraigo f√°cilmente porque evito quedarme en lo inc√≥modo." },
  { kind: "type", t: 7, q: "Busco satisfacci√≥n constante porque necesito evitar el vac√≠o." },

  // Tipo 8
  { kind: "type", t: 8, q: "Me muestro fuerte porque temo ser controlado o da√±ado." },
  { kind: "type", t: 8, q: "Tomo el control porque necesito protegerme." },
  { kind: "type", t: 8, q: "Act√∫o de forma directa porque no quiero mostrar vulnerabilidad." },
  { kind: "type", t: 8, q: "Me enfrento a los conflictos porque necesito sentirme en control." },
  { kind: "type", t: 8, q: "Busco autonom√≠a total porque necesito sentir que nadie me controla." },

  // Tipo 9
  { kind: "type", t: 9, q: "Evito el conflicto porque temo perder la conexi√≥n con los dem√°s." },
  { kind: "type", t: 9, q: "Me adapto a otros porque quiero mantener la armon√≠a." },
  { kind: "type", t: 9, q: "Minimizo mis propias necesidades porque temo generar tensi√≥n." },
  { kind: "type", t: 9, q: "Posterg√≥ decisiones porque quiero evitar el malestar." },
  { kind: "type", t: 9, q: "Busco estabilidad y paz porque necesito sentirme en equilibrio." },

  // =========================
  // 15 PREGUNTAS INSTINTOS (5 + 5 + 5)
  // =========================

  // SP - Autoconservaci√≥n
  { kind: "instinct", inst: "sp", q: "Me preocupa tener estabilidad material (dinero/recursos) para estar tranquilo." },
  { kind: "instinct", inst: "sp", q: "Priorizo descansar y mantener mi energ√≠a para rendir bien en el d√≠a a d√≠a." },
  { kind: "instinct", inst: "sp", q: "Me importa sentir comodidad f√≠sica y evitar situaciones que me desgasten demasiado." },
  { kind: "instinct", inst: "sp", q: "Me enfoco en cuidar mi salud y prevenir problemas antes de que aparezcan." },
  { kind: "instinct", inst: "sp", q: "Me gusta planificar para asegurarme de que no falte lo necesario." },

  // SX - Sexual / Uno a uno
  { kind: "instinct", inst: "sx", q: "Busco v√≠nculos intensos y sentir una conexi√≥n especial con alguien." },
  { kind: "instinct", inst: "sx", q: "La qu√≠mica y la intensidad emocional influyen mucho en mis decisiones." },
  { kind: "instinct", inst: "sx", q: "Prefiero relaciones profundas antes que muchos v√≠nculos superficiales." },
  { kind: "instinct", inst: "sx", q: "Me importa ser significativo para alguien y sentirme elegido." },
  { kind: "instinct", inst: "sx", q: "Me energiza lo apasionante y lo que me hace sentir muy vivo." },

  // SO - Social
  { kind: "instinct", inst: "so", q: "Me importa entender mi lugar en los grupos y c√≥mo encajo socialmente." },
  { kind: "instinct", inst: "so", q: "Me interesa pertenecer, aportar y sentir comunidad." },
  { kind: "instinct", inst: "so", q: "Suelo estar atento a din√°micas sociales, normas y reputaci√≥n." },
  { kind: "instinct", inst: "so", q: "Me motiva generar redes y conexiones √∫tiles." },
  { kind: "instinct", inst: "so", q: "Me importa contribuir a algo m√°s grande que yo (grupo/proyecto/causa)." }
];



  function renderQ() {
    if (qIdx >= questions.length) { finish(); return; }
    document.getElementById('q-text').innerText = questions[qIdx].q;
    let pct = Math.round((qIdx / questions.length) * 100);
    document.getElementById('progress-fill').style.width = pct + "%";
    document.getElementById('progress-text').innerText = pct + "%";
    const btnBack = document.getElementById('btn-back');
    if (qIdx > 0) btnBack.style.visibility = 'visible';
    else btnBack.style.visibility = 'hidden';
  }

// Variable para evitar doble click r√°pido
  let isVoting = false;

  function vote(pts) { 
    if (isVoting) return; // Si ya est√° procesando, ignora clicks extra
    isVoting = true;

    // 1. Identificar el bot√≥n tocado y pintarlo
    const buttons = document.querySelectorAll('.scale-option');
    const selectedBtn = buttons[pts - 1]; // pts es 1-5, el array es 0-4
    if(selectedBtn) selectedBtn.classList.add('selected');

    // 2. Esperar un momento (Efecto visual)
    setTimeout(() => {
        // --- L√ìGICA DE GUARDADO ---
 const q = questions[qIdx];
const itemKey = qIdx; // clave √∫nica

if (q.kind === "type") {
  const currentType = q.t;
  if (!userResponses.types[currentType]) userResponses.types[currentType] = {};
  userResponses.types[currentType][itemKey] = pts;
  historyStack.push({ qIdx, kind:"type", key: itemKey, t: currentType });
} else if (q.kind === "instinct") {
  const inst = q.inst; // "sp" | "sx" | "so"
  if (!userResponses.instincts[inst]) userResponses.instincts[inst] = {};
  userResponses.instincts[inst][itemKey] = pts;
  historyStack.push({ qIdx, kind:"instinct", key: itemKey, inst });
}

        // 3. Avanzar
        qIdx++; 
        renderQ(); 

        // 4. Limpiar el color para la pr√≥xima pregunta
        if(selectedBtn) selectedBtn.classList.remove('selected');
        isVoting = false; // Permitir votar de nuevo

    }, 200); // <--- TIEMPO DE ESPERA (200ms = 0.2 segundos)
  }

  function goBack() {
    if (historyStack.length === 0) return; 
    let lastStep = historyStack.pop();

if (lastStep.kind === "type") {
  if (userResponses.types[lastStep.t]) delete userResponses.types[lastStep.t][lastStep.key];
} else if (lastStep.kind === "instinct") {
  if (userResponses.instincts[lastStep.inst]) delete userResponses.instincts[lastStep.inst][lastStep.key];
}

qIdx--;
renderQ();

  }

  // --- 5. ALGORITMO ---
  function calcularResultadoEneagrama(responses) {
  function sumItems(items) {
    let s = 0;
    if (!items) return 0;
    for (const k in items) s += Number(items[k] || 0);
    return s;
  }

  // 1) Puntajes por eneatipo
  const scoresType = {};
  for (let t = 1; t <= 9; t++) {
    scoresType[t] = sumItems(responses.types[t]);
  }

  const sorted = Object.entries(scoresType).sort((a,b) => b[1]-a[1]);
  const core = Number(sorted[0][0]);

  // 2) Ala: compara adyacentes
  const prev = (core === 1) ? 9 : (core - 1);
  const next = (core === 9) ? 1 : (core + 1);

  const prevScore = scoresType[prev] || 0;
  const nextScore = scoresType[next] || 0;

  let alaText = "Alas Balanceadas";
  if (Math.abs(prevScore - nextScore) >= 2) {
    alaText = (prevScore > nextScore) ? ("Ala " + prev) : ("Ala " + next);
  }

  // 3) Instinto: sp/sx/so
  const sSP = sumItems(responses.instincts.sp);
  const sSX = sumItems(responses.instincts.sx);
  const sSO = sumItems(responses.instincts.so);

  let inst = "No definido";
  const max = Math.max(sSP, sSX, sSO);

  // umbral simple para evitar empates raros (ajustable)
  const sortedInst = [
    ["sp", sSP], ["sx", sSX], ["so", sSO]
  ].sort((a,b)=>b[1]-a[1]);

  const topI = sortedInst[0], secondI = sortedInst[1];

  if (max > 0 && (topI[1] - secondI[1]) >= 2) {
    inst = (topI[0] === "sp") ? "Autoconservaci√≥n" : (topI[0] === "sx") ? "Sexual" : "Social";
  } else {
    // si quer√©s que SIEMPRE elija uno igual, reemplaz√° por:
    // inst = (topI[0] === "sp") ? "Autoconservaci√≥n" : (topI[0] === "sx") ? "Sexual" : "Social";
    inst = "Balanceado";
  }

  return { eneatipo: core, ala: alaText, instinto: inst };
}


  // --- 6. FINALIZAR ---
async function finish() {
  nav('view-loading');

const btn = document.getElementById("mp-pay-btn");
if (btn) {
  btn.innerText = "OBTENER MIS RESULTADOS";
  btn.style.pointerEvents = "auto";
}


  try {
    const resultado = calcularResultadoEneagrama(userResponses);
    let type = resultado.eneatipo;
    let tInt = parseInt(type);
    let prev = tInt===1?9:tInt-1;
    let next = tInt===9?1:tInt+1;
    let alaText = resultado.ala || "Alas Balanceadas";


    // Guardamos BASIC sin nombre (se completa en checkout)
    localStorage.setItem('eneagrama_basic', JSON.stringify({
      name: "",
      type: type,
      wing: alaText,
      instinct: resultado.instinto
    }));

    nav('view-result');
    document.getElementById('payment-gate').classList.remove('hidden');
    document.getElementById('actual-report').classList.add('hidden');
    track("checkout_view");

    const btn = document.getElementById("mp-pay-btn");
    btn.onclick = async () => {
      const nm = (document.getElementById("checkout-name")?.value || "").trim();
      const err = document.getElementById("checkout-err");

      if (!nm) {
        if (err) { err.style.display = "block"; err.innerText = "Por favor ingres√° tu nombre."; }
        return;
      }
      if (err) err.style.display = "none";

      try {
        btn.innerText = "Redirigiendo...";
        btn.style.pointerEvents = "none";
        track("checkout_click_mp");

        const basic = JSON.parse(localStorage.getItem("eneagrama_basic") || "{}");
        basic.name = nm;
        localStorage.setItem("eneagrama_basic", JSON.stringify(basic));

        const payload = { nombre: nm, eneatipo: basic.type, ala: basic.wing, instinto: basic.instinct };
        const token = btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
        localStorage.setItem("eneagrama_token", token);

        const r = await fetch("/api/mp_create_preference", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token, price: 4800 })
        });

        const j = await r.json();
        if (!r.ok || !j.init_point) throw new Error(j.error || "No se pudo crear preferencia");

        window.location.href = j.init_point;
      } catch (e) {
        console.error(e);
        btn.innerText = "OBTENER MIS RESULTADOS";
        btn.style.pointerEvents = "auto";
        if (err) { err.style.display = "block"; err.innerText = "Error iniciando el pago. Prob√° de nuevo."; }
      }
    };

  } catch (e) {
    console.error(e);
    nav('view-result');
    const msg = document.getElementById("error-msg");
    if (msg) {
      msg.style.display = "block";
      msg.innerText = "Ocurri√≥ un error calculando el perfil. Recarg√° e intent√° de nuevo.";
    } else {
      alert("Ocurri√≥ un error calculando el perfil.");
    }
  }
}

window.addEventListener("load", async () => {
  try {
    const p = new URLSearchParams(window.location.search);

    // 1) Detectar si esto es una vuelta desde MP con pago aprobado
    const mpStatus = (
      p.get("collection_status") ||
      p.get("status") ||
      p.get("payment_status") ||
      ""
    ).toLowerCase();

    const mpSuccess = (p.get("mp_status") || "").toLowerCase() === "success";
    const approved = mpSuccess || mpStatus === "approved";

    // 2) Obtener token (preferimos URL, si no existe usamos localStorage)
    const token =
      p.get("token") ||
      p.get("state") || // por si alguna vez lo mand√°s as√≠
      localStorage.getItem("eneagrama_token") ||
      "";

    // 3) Obtener paymentId (MP puede volver con diferentes nombres)
    const paymentId =
      p.get("payment_id") ||
      p.get("collection_id") ||
      p.get("paymentId") ||
      "";

    // Si no es un return aprobado o faltan datos, no hacemos nada
    if (!approved || !token || !paymentId) {
      console.log("[RETURN] No es un regreso de pago aprobado (o faltan token/paymentId).");
      return;
    }

    // 4) Guardar paymentId para enviar email despu√©s
    localStorage.setItem("last_payment_id", paymentId);

    nav("view-loading");

    // 5) Recuperar datos b√°sicos del usuario
    let basic = {};
    try {
      basic = JSON.parse(decodeURIComponent(escape(atob(token))));
    } catch (e) {
      basic = JSON.parse(localStorage.getItem("eneagrama_basic") || "{}");
    }

    // 6) Verificar pago + pedir reporte al backend
    const r = await fetch("/api/mp_verify_and_report", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ token, payment_id: paymentId }),
    });

    const j = await r.json().catch(() => ({}));
    if (!r.ok || !j.reporte) throw new Error(j.error || "La API no devolvi√≥ reporte.");

    // 7) Pintar reporte en UI
    const elAI = document.getElementById("ai-content");
    const gate = document.getElementById("payment-gate");
    const report = document.getElementById("actual-report");

    if (!elAI || !gate || !report) {
      throw new Error("Faltan elementos en el HTML (ai-content / payment-gate / actual-report).");
    }

    const elName = document.getElementById("r-name");
    const elType = document.getElementById("r-type");
    const elWing = document.getElementById("r-wing");
    const elInst = document.getElementById("r-instinct");

    if (elName) elName.innerText = basic.name ? basic.name + "," : "";
    if (elType) elType.innerText = basic.type ? "Eneatipo " + basic.type : "-";
    if (elWing) elWing.innerText = basic.wing ? basic.wing : "Alas balanceadas";
    if (elInst) elInst.innerText = basic.instinct ? basic.instinct : "No predominante";

    elAI.innerHTML = j.reporte;

    nav("view-result");
    gate.classList.add("hidden");
    report.classList.remove("hidden");

    console.log("[DONE] Reporte mostrado OK");
  } catch (e) {
    console.error("[ERROR RETURN FLOW]", e);
    safeShowError(
      "Pago aprobado, pero fall√≥ la visualizaci√≥n del reporte. " +
      "Abr√≠ la consola y mandame el error rojo exacto."
    );
  }
});



  // --- L√ìGICA DEL SLIDER ---
  let slideIndex = 0;
  let autoSlideInterval;

  function showSlides() {
    const tracks = document.querySelectorAll('.slider-track');
    if (tracks.length === 0) return;
    const totalSlides = tracks[0].getElementsByClassName('slide').length;

    if (slideIndex >= totalSlides) { slideIndex = 0; }
    if (slideIndex < 0) { slideIndex = totalSlides - 1; }

    tracks.forEach(track => {
      track.style.transform = `translateX(-${slideIndex * 100}%)`;
    });
  }

  function moveSlide(n) {
    slideIndex += n;
    showSlides();
    resetAutoSlide();
  }

  function startAutoSlide() {
    autoSlideInterval = setInterval(() => {
      slideIndex++;
      showSlides();
    }, 4000);
  }

  function resetAutoSlide() {
    clearInterval(autoSlideInterval);
    startAutoSlide();
  }

  startAutoSlide();

async function downloadPDF() {
  const msg = document.getElementById("actions-msg");
  const reportEl = document.getElementById("actual-report");
  const name = (document.getElementById("r-name")?.innerText || "reporte").replace(/[^a-zA-Z0-9_-]/g, "");

  try {
    msg.style.display = "block";
    msg.style.color = "#274E55";
    msg.innerText = "Generando PDF...";

    const opt = {
      margin: 10,
      filename: `MiEneatipo_${name || "reporte"}.pdf`,
      image: { type: "jpeg", quality: 0.98 },
      html2canvas: { scale: 2, useCORS: true },
      jsPDF: { unit: "mm", format: "a4", orientation: "portrait" }
    };

    await html2pdf().set(opt).from(reportEl).save();

    msg.style.color = "#2E5941";
    msg.innerText = "PDF descargado ‚úÖ";
    setTimeout(() => (msg.style.display = "none"), 2500);
  } catch (e) {
    console.error(e);
    msg.style.color = "red";
    msg.innerText = "No se pudo generar el PDF. Prob√° desde Chrome.";
  }
}

async function sendReportByEmail() {
  const email = (document.getElementById("email-input").value || "").trim();
  const msg = document.getElementById("actions-msg");
  const btn = document.getElementById("btn-send-email");

  if (!email || !email.includes("@")) {
    msg.style.display = "block";
    msg.style.color = "red";
    msg.innerText = "Ingres√° un email v√°lido.";
    return;
  }

  const payment_id = localStorage.getItem("last_payment_id");
  const reporte_html = document.getElementById("ai-content")?.innerHTML || "";
  const basic = {
    name: document.getElementById("r-name")?.innerText?.replace(",", "") || "",
    type: document.getElementById("r-type")?.innerText || "",
    wing: document.getElementById("r-wing")?.innerText || "",
    instinct: document.getElementById("r-instinct")?.innerText || ""
  };

  if (!payment_id) {
    msg.style.display = "block";
    msg.style.color = "red";
    msg.innerText = "No encuentro el payment_id. Prob√° recargar la p√°gina desde el link de Mercado Pago.";
    return;
  }

  try {
    btn.innerText = "Enviando...";
    btn.style.pointerEvents = "none";

    msg.style.display = "block";
    msg.style.color = "#274E55";
    msg.innerText = "Enviando mail...";

    const r = await fetch("/api/send_report_email", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, payment_id, reporte_html, basic })
    });

    const j = await r.json().catch(() => ({}));

    if (!r.ok) throw new Error(j.error || "Error enviando email");

    msg.style.color = "#2E5941";
    msg.innerText = "Listo ‚úÖ Te enviamos el informe por mail.";
    btn.innerText = "ENVIAR POR MAIL";
    btn.style.pointerEvents = "auto";
  } catch (e) {
    console.error(e);
    msg.style.color = "red";
    msg.innerText = "No se pudo enviar el mail. Prob√° de nuevo en 30 segundos.";
    btn.innerText = "ENVIAR POR MAIL";
    btn.style.pointerEvents = "auto";
  }
}



</script>

</body>
</html>