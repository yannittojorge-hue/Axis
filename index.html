<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mi Eneatipo | Eneagrama Profesional</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <meta name="description" content="Descubr√≠ tu Eneatipo con el test m√°s preciso de Eneagrama Profesional. Identific√° tu personalidad, herida de origen y camino de crecimiento en minutos." />
  <meta name="keywords" content="eneagrama, test eneatipo, personalidad, psicolog√≠a, riso hudson, test eneagrama argentina, autoconocimiento" />
  <meta name="author" content="Mi Eneatipo" />
  
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://mieneatipo.ar/" />
  <meta property="og:title" content="Test de Eneagrama Profesional | Mi Eneatipo" />
  <meta property="og:description" content="Descubr√≠ tu verdadera arquitectura interna. Hac√© el test y conoc√© tu perfil nuclear hoy mismo." />
  <meta property="og:image" content="https://mieneatipo.ar/logo.svg" />

  <style>

    /* --- ESTILOS GLOBALES --- */
    :root { --bg-main:#F4EFE9; --bg-alt:#FAF8F3; --green:#2E5941; --blue:#274E55; --coral:#FF7F66; --text:#3A3A3A; --white:#FFFFFF; --shadow: 0 10px 30px rgba(39, 78, 85, 0.08); }
    * { box-sizing:border-box; margin:0; padding:0; }
    body { font-family:'Inter', sans-serif; background:var(--bg-main); color:var(--text); line-height:1.6; overflow-x:hidden; }
    
    .bg-gradient { position:fixed; inset:0; z-index:-1; background:radial-gradient(circle at 50% 50%, rgba(255,127,102,0.05), transparent 60%), var(--bg-main); }
    
    .container { max-width:900px; margin:0 auto; padding:0 20px; }
    .hidden { display:none !important; }
    .fade-in { animation:fadeIn 0.6s ease forwards; }
    @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

    /* --- TIPOGRAF√çA Y BOTONES --- */
    h1, h2, h3 { font-family:'Poppins', sans-serif; color:var(--blue); }
    h1 { font-size:clamp(2.5rem, 5vw, 3.5rem); line-height:1.1; margin-bottom:20px; font-weight:600; }
    .highlight { color:var(--coral); display:inline-block; }
    
    .btn { background:var(--coral); color:white; border:none; padding:18px 40px; border-radius:50px; font-family:'Poppins', sans-serif; font-weight:600; font-size:1rem; cursor:pointer; transition:0.3s; box-shadow:0 8px 20px rgba(255,127,102,0.25); text-transform:uppercase; letter-spacing:1px; display:inline-block; text-align:center; }
    .btn:hover { transform:translateY(-3px); background:#E06550; box-shadow:0 12px 25px rgba(255,127,102,0.35); }

    /* --- HEADER --- */
    header { padding:30px 0; } 
    .logo { display:flex; align-items:center; gap:10px; font-weight:700; color:var(--green); font-size:1.5rem; cursor:pointer; }
    .logo svg { width: 36px;   height: auto;  margin-right: 12px;   flex-shrink: 0;  stroke: currentColor; vertical-align: middle}

    /* --- HERO & FORM --- */
    .hero { padding:80px 0; min-height:70vh; display:flex; align-items:center; text-align:center; justify-content:center; }
    .form-box { background:var(--white); padding:50px; border-radius:20px; box-shadow:var(--shadow); max-width:500px; margin:40px auto; text-align:center; }
    .input-group { margin-bottom:25px; text-align:left; }
    label { font-weight:600; font-size:0.9rem; color:var(--blue); display:block; margin-bottom:8px; }
    input { width:100%; padding:15px; border:1px solid #ddd; border-radius:10px; font-size:1.1rem; background:var(--bg-alt); text-align:center; }

    /* --- QUIZ --- */
    .quiz-container { max-width:800px; margin:0 auto; text-align:center; padding:60px 0; }
    .progress-header { display:flex; justify-content:space-between; margin-bottom:8px; font-size:0.8rem; color:#888; font-weight:700; text-transform:uppercase; }
    .progress-bar { height:8px; background:#e0e0e0; border-radius:10px; margin-bottom:40px; overflow:hidden; }
    .progress-fill { height:100%; background:var(--green); width:0%; transition:width 0.3s ease; }
    
    .question-card { background:var(--white); padding:50px 30px; border-radius:20px; box-shadow:0 15px 40px rgba(0,0,0,0.04); min-height:300px; display:flex; flex-direction:column; justify-content:center; }
    .q-text { font-size:1.6rem; font-weight:500; color:var(--blue); margin-bottom:40px; font-family:'Poppins', sans-serif; }
    
  /* --- ESCALA DE PREGUNTAS (CON RETRASO VISUAL) --- */
    .scale-container { display:flex; justify-content:space-between; align-items:flex-start; gap:10px; margin-top:20px; width:100%; }
    
    .scale-option { 
      flex:1; display:flex; flex-direction:column; align-items:center; cursor:pointer; 
      -webkit-tap-highlight-color: transparent; 
    }
    .scale-option:active { transform: scale(0.90); } 

    .scale-circle { 
      width:55px; height:55px; border-radius:50%; border:2px solid #ddd; background:#fff; 
      display:flex; align-items:center; justify-content:center; font-weight:700; font-size:1.3rem; color:#aaa; margin-bottom:12px; 
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; 
    }
    
    .scale-label { font-size:0.7rem; font-weight:700; text-transform:uppercase; color:#999; text-align:center; line-height:1.2; transition: color 0.3s ease; }
    
    /* --- COLORES ACTIVOS (Funciona al Tocar :active Y al Seleccionar .selected) --- */
    
    /* Opci√≥n 1 */
    .scale-option:nth-child(1):active .scale-circle, 
    .scale-option:nth-child(1).selected .scale-circle { background:#D66D5E; border-color:#D66D5E; color:white; transition: none; }
    .scale-option:nth-child(1):active .scale-label,
    .scale-option:nth-child(1).selected .scale-label { color:#D66D5E; transition: none; }

    /* Opci√≥n 2 */
    .scale-option:nth-child(2):active .scale-circle,
    .scale-option:nth-child(2).selected .scale-circle { background:#E89F71; border-color:#E89F71; color:white; transition: none; }
    .scale-option:nth-child(2):active .scale-label,
    .scale-option:nth-child(2).selected .scale-label { color:#E89F71; transition: none; }

    /* Opci√≥n 3 */
    .scale-option:nth-child(3):active .scale-circle,
    .scale-option:nth-child(3).selected .scale-circle { background:#D9C375; border-color:#D9C375; color:white; transition: none; }
    .scale-option:nth-child(3):active .scale-label,
    .scale-option:nth-child(3).selected .scale-label { color:#D9C375; transition: none; }

    /* Opci√≥n 4 */
    .scale-option:nth-child(4):active .scale-circle,
    .scale-option:nth-child(4).selected .scale-circle { background:#87B38D; border-color:#87B38D; color:white; transition: none; }
    .scale-option:nth-child(4):active .scale-label,
    .scale-option:nth-child(4).selected .scale-label { color:#87B38D; transition: none; }

    /* Opci√≥n 5 */
    .scale-option:nth-child(5):active .scale-circle,
    .scale-option:nth-child(5).selected .scale-circle { background:var(--green); border-color:var(--green); color:white; transition: none; }
    .scale-option:nth-child(5):active .scale-label,
    .scale-option:nth-child(5).selected .scale-label { color:var(--green); transition: none; }

    /* PC Hover (Solo Mouse) */
    @media (hover: hover) {
        .scale-option:nth-child(1):hover .scale-circle { background:#D66D5E; border-color:#D66D5E; color:white; }
        .scale-option:nth-child(1):hover .scale-label { color:#D66D5E; }
        .scale-option:nth-child(2):hover .scale-circle { background:#E89F71; border-color:#E89F71; color:white; }
        .scale-option:nth-child(2):hover .scale-label { color:#E89F71; }
        .scale-option:nth-child(3):hover .scale-circle { background:#D9C375; border-color:#D9C375; color:white; }
        .scale-option:nth-child(3):hover .scale-label { color:#D9C375; }
        .scale-option:nth-child(4):hover .scale-circle { background:#87B38D; border-color:#87B38D; color:white; }
        .scale-option:nth-child(4):hover .scale-label { color:#87B38D; }
        .scale-option:nth-child(5):hover .scale-circle { background:var(--green); border-color:var(--green); color:white; }
        .scale-option:nth-child(5):hover .scale-label { color:var(--green); }
    }
    /* --- RESULTADOS --- */
    .result-header { text-align:center; margin-bottom:40px; }
    .result-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:20px; margin-bottom:40px; }
    .result-card { background:var(--white); padding:10px; border-radius:15px; text-align:center; border:1px solid rgba(0,0,0,0.05); box-shadow:0 5px 20px rgba(0,0,0,0.03); display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 140px; }
    .card-label { font-size:0.8rem; color:#888; font-weight:700; text-transform:uppercase; display:block; margin-bottom:10px; letter-spacing:1px; }
    .card-val { font-size:clamp(1.1rem, 3vw, 1.8rem); font-weight:700; color:var(--blue); line-height: 1.2; word-break: break-word; }
    
    .report-box { position:relative; background:var(--white); padding:60px; border-radius:20px; box-shadow:var(--shadow); text-align:left; }
    .ai-text { color:#444; line-height:1.9; font-size:1.1rem; }
    .ai-text h3 { color:var(--green); margin-top:40px; margin-bottom:20px; border-bottom:2px solid var(--bg-main); padding-bottom:10px; font-size:1.4rem; }
    .ai-text h3:first-child { margin-top:0; }
    .ai-text strong { color:var(--blue); font-weight:700; }
    .ai-text ul { margin-left:20px; margin-bottom:30px; }
    .ai-text li { margin-bottom:10px; padding-left:5px; }

    .loader { border:4px solid #f3f3f3; border-top:4px solid var(--coral); border-radius:50%; width:60px; height:60px; animation:spin 1s linear infinite; margin:0 auto 20px; }
    @keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }
    #btn-back:hover { color: var(--coral) !important; text-decoration: underline; }

    /* PANTALLA DE PAGO */
    .pay-gate { background: var(--white); padding: 50px 20px; border-radius: 20px; box-shadow: var(--shadow); text-align: center; max-width: 600px; margin: 40px auto; }
    .social-proof { background: #e8f5e9; color: var(--green); display: inline-block; padding: 5px 15px; border-radius: 50px; font-size: 0.85rem; font-weight: 700; margin-bottom: 20px; }
    .checkout-box { border: 2px solid var(--green); background: #fff; padding: 25px; border-radius: 15px; margin-bottom: 30px; }
    .price-tag { display: flex; justify-content: space-between; align-items: center; font-weight: 700; font-size: 1.2rem; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
    .feature-list { text-align: left; margin: 0 auto 30px auto; max-width: 500px; }
    .feature-item { display: flex; gap: 12px; margin-bottom: 12px; align-items: flex-start; color: #555; font-size: 0.95rem; }
    .icon-check { color: var(--white); background: var(--green); border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; flex-shrink: 0; margin-top: 2px; }

    /* ESTILOS LANDING (HOME) */
    .badge-verified { background: #e6f4ea; color: var(--green); padding: 8px 16px; border-radius: 50px; font-size: 0.85rem; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; margin-bottom: 25px; border: 1px solid rgba(46, 89, 65, 0.1); }
    .benefits-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 50px; text-align: left; }
    .benefit-card { background: white; padding: 30px 25px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.04); transition: transform 0.3s ease; border: 1px solid rgba(0,0,0,0.02); }
    .benefit-card:hover { transform: translateY(-5px); }
    .benefit-icon { width: 50px; height: 50px; background: #e6f4ea; color: var(--green); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-bottom: 15px; }
    .benefit-title { font-weight: 700; color: var(--blue); margin-bottom: 8px; font-size: 1.1rem; }
    .benefit-desc { font-size: 0.9rem; color: #666; line-height: 1.5; }
    .preview-section { margin-top: 60px; text-align: left; background: white; padding: 30px; border-radius: 20px; box-shadow: var(--shadow); }
    .preview-list li { margin-bottom: 12px; display: flex; gap: 10px; align-items: center; color: #444; }

/* --- SLIDER DE TESTIMONIOS (DEFINITIVO) --- */
    .slider-container { 
      max-width: 800px; 
      margin: 40px auto; 
      padding: 0 10px;
      position: relative;
    }

    .slider-title { 
      text-align: center; 
      color: var(--blue); 
      font-size: 1.4rem; 
      font-weight: 700; 
      margin-bottom: 20px; 
      display: flex; align-items: center; justify-content: center; gap: 10px; 
    }

    /* ESTA ES LA CLASE QUE FALTABA PARA ENCUADRAR */
    .slider-wrapper {
      position: relative;
      padding: 0 45px; /* Espacio para las flechas */
    }

    .slider-window { 
      overflow: hidden; 
      border-radius: 20px; 
      background: #fff; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
      border: 1px solid rgba(0,0,0,0.05); 
      position: relative;
    }

    .slider-track { 
      display: flex; 
      transition: transform 0.5s ease-in-out; 
      width: 100%; 
      margin: 0; padding: 0;
    }
    
    .slide { 
      flex: 0 0 100%; 
      width: 100%;
      box-sizing: border-box; 
      padding: 40px; 
      display: flex; 
      align-items: center; 
      gap: 30px; 
      justify-content: center;
    }

    .slide-img-box { 
      flex-shrink: 0; 
      width: 110px; height: 110px; 
      border-radius: 50%; 
      overflow: hidden; 
      border: 4px solid #e6f4ea; 
    }
    .slide-img-box img { width: 100%; height: 100%; object-fit: cover; }
    .slide-content { text-align: left; flex: 1; }
    .stars { color: #FFC107; letter-spacing: 2px; margin-bottom: 10px; font-size: 1rem; }
    .quote-text { font-size: 0.95rem; color: #555; font-style: italic; line-height: 1.5; margin-bottom: 15px; display: block; }
    .author-name { font-weight: 800; color: var(--text); font-size: 1rem; display: block; }
    .author-type { color: var(--green); font-weight: 600; font-size: 0.85rem; text-transform: uppercase; margin-top: 4px; display: block;}

    /* FLECHAS */
    .slider-btn { 
      position: absolute; 
      top: 50%; 
      transform: translateY(-50%); 
      width: 40px; height: 40px; 
      background: white; 
      border: 1px solid #eee; 
      border-radius: 50%; 
      cursor: pointer; 
      display: flex; align-items: center; justify-content: center; 
      font-weight: bold; color: var(--blue); 
      box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
      z-index: 100; 
      font-size: 1.2rem; 
    }
    .slider-btn:hover { background: var(--green); color: white; border-color: var(--green); }
    .prev-btn { left: 0; }
    .next-btn { right: 0; }

    @media (max-width: 600px) {
      .slider-wrapper { padding: 0; }
      .slide { flex-direction: column; text-align: center; padding: 40px 20px 60px 20px; }
      .slide-content { text-align: center; }
      .slide-img-box { width: 90px; height: 90px; margin-bottom: 15px; }
      /* Flechas abajo en celular */
      .slider-btn { top: auto; bottom: 10px; width: 35px; height: 35px; }
      .prev-btn { left: 30%; transform: translateX(-50%); }
      .next-btn { right: 30%; transform: translateX(50%); }
    }
/* CORRECCI√ìN PARA QUE SE VEA EL SLIDER EN HOME */
    .hero-landing {
        display: block !important; /* Fuerza bloque vertical */
        padding-top: 40px;
        padding-bottom: 80px;
        height: auto !important; /* Deja que crezca lo que necesite */
        min-height: 100vh;
        text-align: center;
    }
    
    /* Asegura que los slides no se achiquen */
    .slide { flex-shrink: 0; }
/* --- CORRECCI√ìN PARA CELULARES
  @media (max-width: 600px) {
    /* 1. Achicamos el relleno de la tarjeta blanca para ganar espacio a los costados */
    .question-card {
      padding: 30px 15px !important; 
    }

    /* 2. Achicamos un poco la letra de la pregunta */
    .q-text {
      font-size: 1.3rem !important;
    }

    /* 3. Hacemos los c√≠rculos m√°s chicos (40px en vez de 55px) */
    .scale-circle {
      width: 40px !important;
      height: 40px !important;
      font-size: 1rem !important;
      border-width: 1px !important;
    }

    /* 4. Achicamos el espacio entre opciones */
    .scale-container {
      gap: 4px !important;
    }

    /* 5. Ajustamos el texto (Nunca, Siempre) para que no se rompa */
    .scale-label {
      font-size: 0.6rem !important;
      margin-top: 4px !important;
    }
  }
  </style>
</head>
<body>

<div class="bg-gradient"></div>

<div class="container">
<header>
  <div class="logo" onclick="location.reload()">
    <img src="logo.svg" alt="S√≠mbolo Eneagrama" style="width: 40px; height: auto; margin-right: 8px;">
    Mi Eneatipo
  </div>
</header>

<div style="text-align: center; margin-bottom: 20px;">
   <div class="badge-verified" style="margin-bottom: 0;">
     <span>‚úì</span> Basado en metodolog√≠a Riso-Hudson & Psicolog√≠a Transpersonal
   </div>
</div>

<div id="view-home" class="fade-in">
    <section class="hero hero-landing">

      <h1 style="margin-bottom: 15px;">Descubre tu verdadera<br><span class="highlight">Arquitectura Interna.</span></h1>
      
      <p style="font-size:1.2rem; max-width:700px; margin:0 auto 30px auto; opacity:0.8; line-height: 1.6;">
        El test de Eneagrama m√°s preciso para identificar tu Eneatipo, entender tus motivaciones inconscientes y potenciar tu crecimiento personal.
      </p>
      
      <button class="btn" onclick="nav('view-form')" style="padding: 20px 50px; font-size: 1.1rem; margin-bottom: 20px;">
        EMPEZAR TEST
      </button>
      
      <div style="font-size: 0.8rem; color: #888; margin-bottom: 60px;">
        ‚è± Toma solo 10-12 minutos ‚Ä¢ üîí Tus datos est√°n seguros
      </div>

      <div class="benefits-grid" style="margin-bottom: 60px;">
        <div class="benefit-card">
          <div class="benefit-icon">üß†</div>
          <div class="benefit-title">Tu Perfil Nuclear</div>
          <div class="benefit-desc">Descubr√≠ exactamente cu√°l de los 9 eneatipos es tu eje central y c√≥mo define tu visi√≥n del mundo.</div>
        </div>
        <div class="benefit-card">
          <div class="benefit-icon">üõ°Ô∏è</div>
          <div class="benefit-title">Mecanismos de Defensa</div>
          <div class="benefit-desc">Entend√© qu√© hac√©s inconscientemente cuando est√°s bajo estr√©s y c√≥mo desactivar el piloto autom√°tico.</div>
        </div>
        <div class="benefit-card">
          <div class="benefit-icon">üöÄ</div>
          <div class="benefit-title">Ruta de Crecimiento</div>
          <div class="benefit-desc">Recib√≠ un plan de acci√≥n claro para integrar tu personalidad y mejorar tus v√≠nculos.</div>
        </div>
      </div>

      <div style="background:white; padding:40px 30px; border-radius:20px; text-align:left; border: 1px solid rgba(0,0,0,0.05); max-width: 600px; margin: 0 auto 60px auto; box-shadow: 0 10px 40px rgba(0,0,0,0.05);">
        <h3 style="font-size:1.4rem; margin-bottom:25px; color:var(--blue); font-weight: 700; text-align: center;">¬øQu√© vas a descubrir hoy?</h3>

        <div class="feature-list" style="margin:0 auto;">
           <div class="feature-item">
              <div class="icon-check">‚úì</div>
              <div>Tu <strong>Eneatipo dominante</strong>, Ala e Instinto.</div>
           </div>
           <div class="feature-item">
              <div class="icon-check">‚úì</div>
              <div>An√°lisis de tu <strong>Herida de Origen</strong> y Deseo B√°sico.</div>
           </div>
           <div class="feature-item">
              <div class="icon-check">‚úì</div>
              <div><strong>Pr√°cticas de alineaci√≥n</strong> personalizadas.</div>
           </div>
           <div class="feature-item">
              <div class="icon-check">‚úì</div>
              <div>Acceso inmediato a tu <strong>informe digital</strong>.</div>
           </div>
        </div>
      </div>
      
      <div class="slider-container">
        <h3 class="slider-title">üí¨ La opini√≥n de nuestros usuarios</h3>
        
        <div class="slider-wrapper">
            <button class="slider-btn prev-btn" onclick="moveSlide(-1)">&#10094;</button>
            
            <div class="slider-window">
              <div class="slider-track">
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Hice otros tests antes pero eran muy gen√©ricos. Este fue distinto: me hizo reflexionar de verdad. Descubr√≠ que buscaba validaci√≥n constante."</span><span class="author-name">Martina S√°nchez</span><span class="author-type">Eneatipo 3 (El Triunfador)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Me costaba horrores comprometerme. Entender mi 'miedo a perderme algo' fue clave para enfocarme. De verdad funciona, me vino muy bien"</span><span class="author-name">Juli√°n Mendez</span><span class="author-type">Eneatipo 7 (El Entusiasta)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Me describi√≥ tal cual: me guardo todo para no discutir y termino explotando. La gu√≠a de crecimiento me ayuda un mont√≥n."</span><span class="author-name">Clara Fern√°ndez</span><span class="author-type">Eneatipo 9 (El Pacificador)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Soy esc√©ptico, pero la precisi√≥n del an√°lisis de riesgo me sorprendi√≥. Una herramienta muy √∫til."</span><span class="author-name">Federico L√≥pez</span><span class="author-type">Eneatipo 6 (El Leal)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1560250097-0b93528c311a?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Era insoportable con los detalles. Entender a mi 'cr√≠tico interno' me dio paz mental."</span><span class="author-name">Gonzalo Duarte</span><span class="author-type">Eneatipo 1 (El Reformador)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Me la pasaba desviviendome por los dem√°s. El reporte me cant√≥ la justa: tengo que aprender a decir que no."</span><span class="author-name">Valentina Ricci</span><span class="author-type">Eneatipo 2 (El Ayudador)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1583195764036-6dc248ac07d9?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Descubr√≠ que mi eneatipo busca control para no ser herido. Me ayud√≥ a bajar un cambio."</span><span class="author-name">Esteban K.</span><span class="author-type">Eneatipo 8 (El Desafiador)</span></div></div>
              </div>
            </div>
            
            <button class="slider-btn next-btn" onclick="moveSlide(1)">&#10095;</button>
        </div>
    </div>
    
    <button class="btn" onclick="nav('view-form')" style="padding: 20px 50px; font-size: 1.1rem; margin-top: 20px;">
        EMPEZAR TEST
    </button>

    </section>
</div>

<div id="view-form" class="hidden fade-in">
  <section class="hero">
    <div class="form-box">
      <h1 style="font-size:2rem; margin-bottom:10px;">Antes de empezar...</h1>
      <p style="color:#666; margin-bottom:30px;">Necesitamos tu nombre para tu reporte final.</p>

      <div class="input-group">
        <label for="name">¬øC√≥mo te gustar√≠a que te llamemos?</label>
        <input type="text" id="name" placeholder="Tu nombre" />
      </div>

      <button class="btn" onclick="startQuiz()" style="width:100%;">
        EMPEZAR
      </button>
    </div>
  </section>
</div>

<div id="view-quiz" class="hidden fade-in">
   <div class="quiz-container">
     <div class="progress-header">
       <span>Tu progreso</span>
       <span id="progress-text">0%</span>
     </div>
     <div class="progress-bar">
       <div class="progress-fill" id="progress-fill"></div>
     </div>

     <div class="question-card">
       <div id="q-text" class="q-text">Cargando pregunta...</div>

       <div class="scale-container">
         <div class="scale-option" onclick="vote(1)">
           <div class="scale-circle">1</div>
           <div class="scale-label">Nunca</div>
         </div>
         <div class="scale-option" onclick="vote(2)">
           <div class="scale-circle">2</div>
           <div class="scale-label">Casi nunca</div>
         </div>
         <div class="scale-option" onclick="vote(3)">
           <div class="scale-circle">3</div>
           <div class="scale-label">A veces</div>
         </div>
         <div class="scale-option" onclick="vote(4)">
           <div class="scale-circle">4</div>
           <div class="scale-label">Frecuente</div>
         </div>
         <div class="scale-option" onclick="vote(5)">
           <div class="scale-circle">5</div>
           <div class="scale-label">Siempre</div>
         </div>
       </div>
     </div>

     <div style="margin-top:30px; display:flex; justify-content:center;">
        <button id="btn-back" onclick="goBack()" style="background:none; border:none; color:#888; font-weight:600; cursor:pointer; font-size:0.9rem;">
          &larr; Volver a la anterior
        </button>
     </div>
   </div>
</div>
  <div id="view-loading" class="hidden fade-in" style="text-align:center; padding:100px 0;">
    <div class="loader"></div>
    <h3 style="color:var(--blue)">Calculando perfil...</h3>
    <p>Estamos analizando tus respuestas y calculando tu eneatipo.</p>
  </div>

  <div id="view-result" class="hidden fade-in">
    
    <div id="payment-gate" class="pay-gate">
      <div class="social-proof">üî• +20.500 personas ya descubrieron su perfil</div>
      <h2 style="margin-bottom:10px; line-height:1.2;">¬°Tu perfil est√° listo para ser revelado!</h2>
      <p style="margin-bottom:30px; color:#666;">Desbloque√° tu reporte completo y empez√° tu camino de crecimiento.</p>

      <div class="checkout-box">
        <div class="price-tag">
          <span>Reporte Premium + Gu√≠a</span>
          <span style="color:var(--green);">$4.800</span>
        </div>
       <button id="mp-pay-btn" class="btn" style="width:100%; font-size:1.1rem; padding: 20px;">
          OBTENER MIS RESULTADOS
       </button>
        <div style="font-size:0.75rem; color:#999; margin-top:10px; display:flex; justify-content:center; gap:15px;">
          <span>üîí Pago 100% Seguro</span>
          <span>‚ö° Acceso Inmediato</span>
        </div>
      </div>

      <div class="feature-list">
        <div class="feature-item"><div class="icon-check">‚úì</div><div><strong>Perfil Nuclear:</strong> Identificaci√≥n precisa de tu Eneatipo, Ala e Instinto.</div></div>
        <div class="feature-item"><div class="icon-check">‚úì</div><div><strong>An√°lisis Inconsciente:</strong> Descubr√≠ tu Herida de origen y tu Deseo fundamental.</div></div>
        <div class="feature-item"><div class="icon-check">‚úì</div><div><strong>Tu Defensa:</strong> Entend√© cu√°l es tu mecanismo de defensa y c√≥mo te limita.</div></div>
        <div class="feature-item"><div class="icon-check">‚úì</div><div><strong>Ruta de Crecimiento:</strong> Camino de integraci√≥n y pr√°cticas de alineaci√≥n personal.</div></div>
      </div>
      
<div class="slider-container">
        <h3 class="slider-title">üí¨ La opini√≥n de nuestros usuarios</h3>
        
        <div class="slider-wrapper">
            <button class="slider-btn prev-btn" onclick="moveSlide(-1)">&#10094;</button>
            
            <div class="slider-window">
              <div class="slider-track">
                <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Hice otros tests antes pero eran muy gen√©ricos. Este fue distinto: me hizo reflexionar de verdad. Descubr√≠ que buscaba validaci√≥n constante."</span><span class="author-name">Martina S√°nchez</span><span class="author-type">Eneatipo 3 (El Triunfador)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Me costaba horrores comprometerme. Entender mi 'miedo a perderme algo' fue clave para enfocarme. De verdad funciona, me vino muy bien"</span><span class="author-name">Juli√°n Mendez</span><span class="author-type">Eneatipo 7 (El Entusiasta)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Me describi√≥ tal cual: me guardo todo para no discutir y termino explotando. La gu√≠a de crecimiento me ayuda un mont√≥n."</span><span class="author-name">Clara Fern√°ndez</span><span class="author-type">Eneatipo 9 (El Pacificador)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Soy esc√©ptico, pero la precisi√≥n del an√°lisis de riesgo me sorprendi√≥. Una herramienta muy √∫til."</span><span class="author-name">Federico L√≥pez</span><span class="author-type">Eneatipo 6 (El Leal)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1560250097-0b93528c311a?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Era insoportable con los detalles. Entender a mi 'cr√≠tico interno' me dio paz mental."</span><span class="author-name">Gonzalo Duarte</span><span class="author-type">Eneatipo 1 (El Reformador)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Me la pasaba desviviendome por los dem√°s. El reporte me cant√≥ la justa: tengo que aprender a decir que no."</span><span class="author-name">Valentina Ricci</span><span class="author-type">Eneatipo 2 (El Ayudador)</span></div></div>
                 <div class="slide"><div class="slide-img-box"><img src="https://images.unsplash.com/photo-1583195764036-6dc248ac07d9?auto=format&fit=crop&w=200&h=200"></div><div class="slide-content"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span class="quote-text">"Descubr√≠ que mi eneatipo busca control para no ser herido. Me ayud√≥ a bajar un cambio."</span><span class="author-name">Esteban K.</span><span class="author-type">Eneatipo 8 (El Desafiador)</span></div></div>
              </div>
            </div>
            
            <button class="slider-btn next-btn" onclick="moveSlide(1)">&#10095;</button>
        </div>
    </div>

    <div id="actual-report" class="hidden">
      <div class="result-header">
        <span class="badge" style="background:#E6F4EA; color:#1E8E3E; padding:5px 15px; border-radius:15px; font-weight:700;">‚úì REPORTE DESBLOQUEADO</span>
        <h2 style="margin-top:15px;">Tu Mapa Mi Eneatipo</h2>
        <p>Hola <strong id="r-name"></strong>, este es tu dise√±o √∫nico.</p>
      </div>
      <div class="result-grid">
        <div class="result-card" style="background:var(--blue);">
          <span class="card-label" style="color:rgba(255,255,255,0.7)">ENEATIPO</span>
          <div class="card-val" style="color:white;" id="r-type">...</div>
        </div>
        <div class="result-card">
          <span class="card-label">ALA DOMINANTE</span>
          <div class="card-val" id="r-wing">...</div>
        </div>
        <div class="result-card">
          <span class="card-label">INSTINTO</span>
          <div class="card-val" id="r-instinct">...</div>
        </div>
      </div>
      <div class="report-box">
        <div id="ai-content" class="ai-text"></div>
      </div>
    </div>
    <div id="error-msg" style="color:red; text-align:center; display:none; margin-top:20px;"></div>
  </div>
</div>

<script>
  // --- 1. FUNCIONES UI ---
  function nav(id) {
    document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
    window.scrollTo(0,0);
  }

  // --- 2. VARIABLES ---
  let user = { name: "" };
  let userResponses = { 1:{}, 2:{}, 3:{}, 4:{}, 5:{}, 6:{}, 7:{}, 8:{}, 9:{} };
  let qIdx = 0;
  let historyStack = [];

  // --- 3. PREGUNTAS ---
  const questions = [
    { t:1, q:"Busco hacer las cosas correctamente porque siento una presi√≥n interna por cumplir con lo que considero correcto." },
    { t:1, q:"Me cuesta relajarme porque siempre percibo que algo podr√≠a hacerse mejor." },
    { t:1, q:"Me critico con dureza porque siento que no deber√≠a cometer errores." },
    { t:1, q:"Mantengo est√°ndares altos porque temo actuar de una manera incorrecta o reprochable." },
    { t:1, q:"Siento incomodidad o culpa porque no logro cumplir con mis propios ideales." },
    { t:1, q:"Contengo mi enojo porque creo que expresarlo ser√≠a inapropiado o injusto." },
    { t:1, q:"Me resulta dif√≠cil disfrutar porque siento que primero debo cumplir con mis responsabilidades." },
    { t:1, q:"Me irrita la falta de compromiso porque creo que las personas deber√≠an esforzarse m√°s." },
    { t:1, q:"Evito el conflicto porque prefiero mantener la armon√≠a y el autocontrol." },
    { t:1, q:"Corrijo o ayudo a otros porque siento responsabilidad por que las cosas se hagan bien." },
    { t:1, q:"Me esfuerzo por ser responsable y correcto porque as√≠ siento que soy una buena persona." },
    { t:2, q:"Estoy atento a las necesidades de los dem√°s porque temo no ser querido si no soy necesario." },
    { t:2, q:"Me involucro emocionalmente con otros porque necesito sentirme importante en sus vidas." },
    { t:2, q:"Me cuesta reconocer mis propias necesidades porque priorizo el bienestar de los dem√°s." },
    { t:2, q:"Ofrezco ayuda incluso sin que me la pidan porque temo ser dejado de lado." },
    { t:2, q:"Busco cercan√≠a afectiva porque necesito sentir que soy valioso para otros." },
    { t:2, q:"Me adapto a lo que otros esperan porque as√≠ aseguro el v√≠nculo." },
    { t:2, q:"Evito pedir ayuda porque siento que debo dar m√°s de lo que recibo." },
    { t:2, q:"Me esfuerzo por agradar porque temo perder el afecto de las personas importantes." },
    { t:2, q:"Me contengo emocionalmente porque prefiero mantener la calma y no generar tensi√≥n." },
    { t:2, q:"Me esfuerzo por destacar y ser √∫til porque as√≠ siento que merezco amor." },
    { t:2, q:"Me involucro intensamente en las relaciones porque necesito sentirme indispensable." },
    { t:3, q:"Me esfuerzo por lograr objetivos porque necesito sentir que valgo por lo que hago." },
    { t:3, q:"Busco ser eficiente porque temo fracasar y perder reconocimiento." },
    { t:3, q:"Me adapto a distintos contextos porque quiero asegurar el √©xito." },
    { t:3, q:"Evito mostrar debilidades porque temo parecer incompetente." },
    { t:3, q:"Me enfoco en resultados porque siento que el valor personal depende del rendimiento." },
    { t:3, q:"Me mantengo ocupado porque detenerme me conecta con la sensaci√≥n de vac√≠o." },
    { t:3, q:"Muestro una imagen segura porque temo que otros vean mis inseguridades." },
    { t:3, q:"Compito conmigo mismo porque necesito superarme constantemente." },
    { t:3, q:"Busco agradar y ayudar porque quiero ser valorado por los dem√°s." },
    { t:3, q:"Busco diferenciarme porque necesito sentirme especial adem√°s de exitoso." },
    { t:3, q:"Me esfuerzo por mantener una imagen exitosa porque as√≠ siento que tengo identidad." },
    { t:4, q:"Me siento diferente a los dem√°s porque percibo que me falta algo esencial." },
    { t:4, q:"Busco profundidad emocional porque temo vivir una vida vac√≠a o superficial." },
    { t:4, q:"Me conecto con emociones intensas porque as√≠ siento que soy aut√©ntico." },
    { t:4, q:"Me comparo con otros porque siento que ellos tienen algo que yo no tengo." },
    { t:4, q:"Busco una identidad propia porque temo no tener un lugar claro." },
    { t:4, q:"Me refugio en mis emociones porque me ayudan a entender qui√©n soy." },
    { t:4, q:"Me cuesta sostener la estabilidad porque siento que perder√≠a intensidad." },
    { t:4, q:"Idealizo lo que no tengo porque me conecta con el anhelo." },
    { t:4, q:"Me esfuerzo por lograr cosas porque quiero sentir que valgo tanto como otros." },
    { t:4, q:"Me retraigo y observo porque necesito proteger mi mundo interno." },
    { t:4, q:"Busco v√≠nculos intensos porque necesito sentirme profundamente conectado." },
    { t:5, q:"Me distancio emocionalmente porque temo quedarme sin recursos internos." },
    { t:5, q:"Busco comprender antes de actuar porque necesito sentirme preparado." },
    { t:5, q:"Protejo mi tiempo y energ√≠a porque temo sentirme invadido." },
    { t:5, q:"Me retiro del contacto social porque necesito conservar mi autonom√≠a." },
    { t:5, q:"Acumulo conocimiento porque siento que as√≠ puedo manejar el mundo." },
    { t:5, q:"Analizo situaciones porque me ayuda a no sentirme desbordado." },
    { t:5, q:"Evito depender de otros porque temo perder control." },
    { t:5, q:"Me mantengo reservado porque necesito cuidar mi espacio interno." },
    { t:5, q:"Me conecto con lo emocional porque busco profundidad personal." },
    { t:5, q:"Busco seguridad en reglas o personas confiables porque necesito certeza." },
    { t:5, q:"Priorizo la autosuficiencia porque necesito sentir que puedo sostenerme solo." },
    { t:6, q:"Busco seguridad porque temo que algo salga mal." },
    { t:6, q:"Me mantengo alerta porque necesito anticipar riesgos." },
    { t:6, q:"Dudo de mis decisiones porque temo equivocarme." },
    { t:6, q:"Busco apoyo externo porque necesito sentir respaldo." },
    { t:6, q:"Desconf√≠o inicialmente porque temo ser traicionado." },
    { t:6, q:"Me preparo para distintos escenarios porque necesito sentirme seguro." },
    { t:6, q:"Cuestiono la autoridad porque temo confiar ciegamente." },
    { t:6, q:"Me comprometo con personas o grupos porque necesito pertenecer." },
    { t:6, q:"Me retraigo para observar porque necesito claridad antes de actuar." },
    { t:6, q:"Act√∫o con firmeza porque necesito demostrar fortaleza." },
    { t:6, q:"Busco lealtad y estructura porque as√≠ siento estabilidad." },
    { t:7, q:"Busco nuevas experiencias porque temo sentirme limitado o atrapado." },
    { t:7, q:"Evito el dolor porque quiero mantenerme bien." },
    { t:7, q:"Me entusiasmo r√°pidamente porque necesito sentirme vivo." },
    { t:7, q:"Cambio de intereses porque temo aburrirme o perder opciones." },
    { t:7, q:"Mantengo una actitud positiva porque temo enfrentar el sufrimiento." },
    { t:7, q:"Planeo m√∫ltiples alternativas porque quiero asegurar libertad." },
    { t:7, q:"Me distraigo f√°cilmente porque evito quedarme en lo inc√≥modo." },
    { t:7, q:"Minimizo los problemas porque quiero seguir adelante." },
    { t:7, q:"Me enfoco en ayudar porque quiero sentir conexi√≥n emocional." },
    { t:7, q:"Me afirmo con firmeza porque necesito sentir control." },
    { t:7, q:"Busco satisfacci√≥n constante porque necesito evitar el vac√≠o." },
    { t:8, q:"Me muestro fuerte porque temo ser controlado o da√±ado." },
    { t:8, q:"Tomo el control porque necesito protegerme." },
    { t:8, q:"Act√∫o de forma directa porque no quiero mostrar vulnerabilidad." },
    { t:8, q:"Desconf√≠o de la debilidad porque temo perder poder." },
    { t:8, q:"Me enfrento a los conflictos porque necesito sentirme en control." },
    { t:8, q:"Protejo a los m√≠os porque siento responsabilidad por ellos." },
    { t:8, q:"Reacciono con intensidad porque no tolero sentirme limitado." },
    { t:8, q:"Me afirmo con fuerza porque temo que otros me dominen." },
    { t:8, q:"Me conecto emocionalmente porque conf√≠o profundamente." },
    { t:8, q:"Me vuelvo estrat√©gico porque necesito anticiparme." },
    { t:8, q:"Busco autonom√≠a total porque necesito sentir que nadie me controla." },
    { t:9, q:"Evito el conflicto porque temo perder la conexi√≥n con los dem√°s." },
    { t:9, q:"Me adapto a otros porque quiero mantener la armon√≠a." },
    { t:9, q:"Minimizo mis propias necesidades porque temo generar tensi√≥n." },
    { t:9, q:"Busco tranquilidad porque no quiero sentirme alterado." },
    { t:9, q:"Me cuesta priorizarme porque temo crear conflicto." },
    { t:9, q:"Posterg√≥ decisiones porque quiero evitar el malestar." },
    { t:9, q:"Me desconecto internamente porque as√≠ mantengo la calma." },
    { t:9, q:"Acepto situaciones porque prefiero no confrontar." },
    { t:9, q:"Me esfuerzo por hacer lo correcto porque quiero sentir coherencia." },
    { t:9, q:"Busco agradar porque quiero sentir pertenencia." },
    { t:9, q:"Busco estabilidad y paz porque necesito sentirme en equilibrio." }
  ];

  // --- 4. MOTOR DEL QUIZ ---
  function startQuiz() {
    user.name = document.getElementById('name').value;
    if(!user.name) { alert("Por favor ingresa tu nombre"); return; }
    nav('view-quiz');
    renderQ();
  }

  function renderQ() {
    if (qIdx >= questions.length) { finish(); return; }
    document.getElementById('q-text').innerText = questions[qIdx].q;
    let pct = Math.round((qIdx / questions.length) * 100);
    document.getElementById('progress-fill').style.width = pct + "%";
    document.getElementById('progress-text').innerText = pct + "%";
    const btnBack = document.getElementById('btn-back');
    if (qIdx > 0) btnBack.style.visibility = 'visible';
    else btnBack.style.visibility = 'hidden';
  }

// Variable para evitar doble click r√°pido
  let isVoting = false;

  function vote(pts) { 
    if (isVoting) return; // Si ya est√° procesando, ignora clicks extra
    isVoting = true;

    // 1. Identificar el bot√≥n tocado y pintarlo
    const buttons = document.querySelectorAll('.scale-option');
    const selectedBtn = buttons[pts - 1]; // pts es 1-5, el array es 0-4
    if(selectedBtn) selectedBtn.classList.add('selected');

    // 2. Esperar un momento (Efecto visual)
    setTimeout(() => {
        // --- L√ìGICA DE GUARDADO ---
        const currentType = questions[qIdx].t;
        const itemIdx = (qIdx % 11) + 1;
        
        if (!userResponses[currentType]) userResponses[currentType] = {};
        userResponses[currentType][itemIdx] = pts;
        historyStack.push({ qIdx: qIdx, type: currentType, item: itemIdx });
        
        // 3. Avanzar
        qIdx++; 
        renderQ(); 

        // 4. Limpiar el color para la pr√≥xima pregunta
        if(selectedBtn) selectedBtn.classList.remove('selected');
        isVoting = false; // Permitir votar de nuevo

    }, 200); // <--- TIEMPO DE ESPERA (200ms = 0.2 segundos)
  }

  function goBack() {
    if (historyStack.length === 0) return; 
    let lastStep = historyStack.pop();
    if (userResponses[lastStep.type]) delete userResponses[lastStep.type][lastStep.item];
    qIdx--;
    renderQ();
  }

  // --- 5. ALGORITMO ---
  function calcularResultadoEneagrama(responses) {
    const W = { CORE:1.5, STRAT:1, WING:0.75, INST:0.5 };
    const INSTINCT_MAP = { 1:"Autoconservaci√≥n",2:"Sexual",3:"Social", 4:"Sexual",5:"Autoconservaci√≥n",6:"Social", 7:"Autoconservaci√≥n",8:"Sexual",9:"Social" };

    function scoreType(items){
      let s=0;
      for(let i=1;i<=5;i++) if(items[i]) s+=items[i]*W.CORE;
      for(let i=6;i<=8;i++) if(items[i]) s+=items[i]*W.STRAT;
      for(let i=9;i<=10;i++) if(items[i]) s+=items[i]*W.WING;
      if(items[11]) s+=items[11]*W.INST;
      return s;
    }

    function detectWing(items){
      const a=items[9]||0, b=items[10]||0;
      if(a<3 && b<3) return "Ala poco marcada";
      if(Math.abs(a-b)>=0.75) return a>b?"Ala A":"Ala B";
      return "Ala Balanceada"; 
    }

    let scoresObj={};
    for(let t=1;t<=9;t++) scoresObj[t]=scoreType(responses[t]);
    let sorted=Object.entries(scoresObj).sort((a,b)=>b[1]-a[1]);
    let top=sorted[0];

    return { eneatipo:Number(top[0]), ala:detectWing(responses[top[0]]), instinto: (responses[top[0]][11]>=4) ? INSTINCT_MAP[top[0]] : "No definido" };
  }

  // --- 6. FINALIZAR ---
async function finish() {
  nav('view-loading');

  try {
    const resultado = calcularResultadoEneagrama(userResponses);
    let type = resultado.eneatipo;
    let tInt = parseInt(type);
    let prev = tInt===1?9:tInt-1;
    let next = tInt===9?1:tInt+1;
    let alaText = "";

    if (resultado.ala === "Ala A") alaText = "Ala " + prev;
    else if (resultado.ala === "Ala B") alaText = "Ala " + next;
    else alaText = "Alas Balanceadas";

    // Creamos un token simple con lo necesario (base64)
    const payload = { nombre: user.name, eneatipo: type, ala: alaText, instinto: resultado.instinto };
    const token = btoa(unescape(encodeURIComponent(JSON.stringify(payload))));

    // Guardamos SOLO lo b√°sico para mostrar luego
    localStorage.setItem('eneagrama_token', token);
    localStorage.setItem('eneagrama_basic', JSON.stringify({
      name: user.name, type: type, wing: alaText, instinct: resultado.instinto
    }));

    // Mostrar pantalla de pago
    nav('view-result');
    document.getElementById('payment-gate').classList.remove('hidden');
    document.getElementById('actual-report').classList.add('hidden');

    // Cambiamos el link del bot√≥n: ahora dispara el checkout din√°mico
    const btn = document.getElementById("mp-pay-btn");
    btn.onclick = async () => {
      btn.innerText = "Redirigiendo...";
      btn.style.pointerEvents = "none";

      const r = await fetch("/api/mp_create_preference", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ token, payment_id: paymentId })

      });
      const j = await r.json();
      if (!j.init_point) throw new Error("No pude crear el link de pago");
      window.location.href = j.init_point;
    };

} catch (e) {
  console.error(e);
  nav('view-result');
  document.getElementById('payment-gate').classList.remove('hidden');
  document.getElementById('actual-report').classList.add('hidden');
  const msg = document.getElementById('error-msg');
  msg.innerText = "Pago aprobado, pero fall√≥ la generaci√≥n del reporte. Prob√° recargar la p√°gina. Si sigue, avisame y lo revisamos.";
  msg.style.display = 'block';
}

}


  // DETECTAR PAGO
 window.onload = async function() {
  const p = new URLSearchParams(window.location.search);

  const mpStatus = (p.get("collection_status") || p.get("status") || "").toLowerCase();
 const rawToken = p.get("token") || localStorage.getItem("eneagrama_token");
 const token = rawToken ? decodeURIComponent(rawToken) : null;

  const paymentId = p.get("payment_id") || p.get("collection_id");

  // Si volvi√≥ aprobado
  if ((mpStatus === "approved" || p.get("mp_status") === "success") && token && paymentId) {
    try {
      nav("view-loading");

      const basic = JSON.parse(localStorage.getItem("eneagrama_basic") || "{}");

      // Pedimos al servidor: verifica pago + genera reporte
      const r = await fetch("/api/mp_verify_and_report", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ token, payment_id: paymentId })
      });

      const j = await r.json();
      if (!r.ok || !j.reporte) throw new Error(j.error || "Error");

      document.getElementById('r-name').innerText = basic.name || "";
      document.getElementById('r-type').innerText = basic.type ? ("Tipo " + basic.type) : "";
      document.getElementById('r-wing').innerText = basic.wing || "";
      document.getElementById('r-instinct').innerText = basic.instinct || "";
      document.getElementById('ai-content').innerHTML = j.reporte;

      nav('view-result');
      document.getElementById('payment-gate').classList.add('hidden');
      document.getElementById('actual-report').classList.remove('hidden');

    } catch (e) {
      console.error(e);
      nav('view-result');
      document.getElementById('error-msg').innerText = "Pago aprobado, pero no pude generar el reporte. Escribinos y lo resolvemos.";
      document.getElementById('error-msg').style.display = 'block';
    }
  }
};


  // --- L√ìGICA DEL SLIDER ---
  let slideIndex = 0;
  let autoSlideInterval;

  function showSlides() {
    const tracks = document.querySelectorAll('.slider-track');
    if (tracks.length === 0) return;
    const totalSlides = tracks[0].getElementsByClassName('slide').length;

    if (slideIndex >= totalSlides) { slideIndex = 0; }
    if (slideIndex < 0) { slideIndex = totalSlides - 1; }

    tracks.forEach(track => {
      track.style.transform = `translateX(-${slideIndex * 100}%)`;
    });
  }

  function moveSlide(n) {
    slideIndex += n;
    showSlides();
    resetAutoSlide();
  }

  function startAutoSlide() {
    autoSlideInterval = setInterval(() => {
      slideIndex++;
      showSlides();
    }, 4000);
  }

  function resetAutoSlide() {
    clearInterval(autoSlideInterval);
    startAutoSlide();
  }

  startAutoSlide();
</script>

</body>
</html>